(function(e){function t(t){for(var r,i,o=t[0],c=t[1],u=t[2],h=0,f=[];h<o.length;h++)i=o[h],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&f.push(a[i][0]),a[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(f.length)f.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],r=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(r=!1)}r&&(s.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},a={app:0},s=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=c;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"01da":function(e,t,n){"use strict";n("e6e4")},"02e5":function(e,t,n){},"09ec":function(e,t,n){"use strict";n("02e5")},"0f88":function(e,t,n){},1404:function(e,t,n){},1662:function(e,t,n){},"28c3":function(e,t,n){"use strict";n("3d9b")},3220:function(e,t,n){},"356d":function(e,t,n){},"3d9b":function(e,t,n){},"3dcd":function(e,t,n){"use strict";n("7b82")},"40fe":function(e,t,n){"use strict";n("a5f4")},"42f9":function(e,t,n){"use strict";n("bdd0")},"460d":function(e,t,n){"use strict";n("5f83")},4678:function(e,t,n){var r={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf755","./tlh.js":"cf755","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function a(e){var t=s(e);return n(t)}function s(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=s,e.exports=a,a.id="4678"},4853:function(e,t,n){"use strict";n("4b19")},"4b19":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("4de4"),n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=n("c1df"),s=n.n(a),i=n("5f5b"),o=n("ccac"),c=n("b1e0"),u=n("89bf"),l=n("51c2"),h=n("521d"),f=n("0c37"),p=(n("f9e3"),n("2dd8"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container main-wrapper",attrs:{id:"app"}},[n("transition",{attrs:{appear:"",name:"fade"}},[n("router-view")],1),n("app-toaster"),n("app-player"),e._l(e.activeStreams,(function(e){return n("app-audio-stream",{key:e.id,attrs:{stream:e}})}))],2)}),d=[],m=n("5530"),v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("audio",{ref:"player",on:{ended:e.onPlayerEnded,loadeddata:e.onPlayerLoadedData,timeupdate:e.onPlayerTimeUpdate,play:e.onPlayerPlay}})},b=[];n("4160"),n("159b");function g(e){return new Date(1e3*e).toISOString().substr(14,5)}var C={data:function(){return{subscribes:[],isPlaying:!1,duration:g(0),playedTime:g(0)}},mounted:function(){var e=this;this.subscribes.push(this.$store.subscribe((function(t){"startStopPlay"===t.type?e.onStartStop():"startPlay"===t.type?e.onStart():"stopPlay"===t.type&&e.onStop()})))},beforeDestroy:function(){this.isPlaying&&this.stop(),this.resetProgress(),this.subscribes.forEach((function(e){e()}))},computed:{newSource:function(){return this.$store.state.audio.startPlay}},methods:{getSource:function(){if(this.$refs.player)return this.$refs.player.src},setSource:function(e){this.$refs.player&&(this.$refs.player.src=e)},onStartStop:function(){this.newSource?this.newSource===this.getSource()&&this.isPlaying?this.onStop():this.onStart():this.onStop()},onStart:function(){(this.getSource()||this.newSource)&&(this.newSource!==this.getSource()?(this.setSource(this.newSource),this.$store.commit("setPlayerSource",this.getSource()),this.play()):this.isPlaying||this.play())},onStop:function(){this.stop()},onPlayerPlay:function(){this.isPlaying||(this.isPlaying=!0,this.$store.commit("setPlayerState",this.isPlaying))},onPlayerEnded:function(){this.isPlaying=!1,this.$store.commit("setPlayerState",this.isPlaying),this.playedTime=g(0),this.$store.commit("setPlayerTime",this.playedTime)},onPlayerLoadedData:function(){this.$refs.player&&(this.resetProgress(),this.duration=g(this.$refs.player.duration),this.$store.commit("setPlayerDuration",this.duration))},onPlayerTimeUpdate:function(){this.$refs.player&&(this.playedTime=g(this.$refs.player.currentTime),this.$store.commit("setPlayerTime",this.playedTime))},stop:function(){this.setSource(void 0),this.$store.commit("setPlayerState",!1)},play:function(){this.getSource()&&this.$refs.player.play()},resetProgress:function(){this.duration=g(0),this.playedTime=g(0),this.$store.commit("setPlayerDuration",this.duration),this.$store.commit("setPlayerTime",this.playedTime)}}},k=C,w=n("2877"),S=Object(w["a"])(k,v,b,!1,null,null,null),y=S.exports,x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"toaster"})},j=[],O={name:"Toaster",data:function(){return{}},computed:{notification:function(){return this.$store.state.ui.notification}},watch:{notification:function(e){e&&(e.error?e.serverError?this.showError("Server Error!"):this.showError(e.message,e.title):this.showNotification(e.message,e.title))}},methods:{showError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ConnectionError",t=arguments.length>1?arguments[1]:void 0;this.showToast({message:e,title:t,variant:"danger",autoHideDelay:3e3})},showNotification:function(e,t){this.showToast({message:e,title:t,variant:"secondary"})},showToast:function(e){var t=e.message,n=void 0===t?"text":t,r=e.title,a=void 0===r?"Attention!":r,s=e.variant,i=void 0===s?"secondary":s,o=e.solid,c=void 0===o||o,u=e.autoHideDelay,l=void 0===u?2e3:u;this.$bvToast.toast(n,{title:a,variant:i,solid:c,autoHideDelay:l})}}},R=O,_=Object(w["a"])(R,x,j,!1,null,null,null),E=_.exports,I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("audio",{ref:"audio",attrs:{autoplay:""}})},T=[],U={name:"AudioStream",props:{stream:MediaStream},data:function(){return{}},mounted:function(){console.log("stream ",this.stream),this.$refs.audio.srcObject=this.stream},beforeDestroy:function(){this.$refs.audio.srcObject=void 0}},M=U,V=Object(w["a"])(M,I,T,!1,null,null,null),$=V.exports,A=n("2f62"),N={components:{appToaster:E,appPlayer:y,appAudioStream:$},computed:Object(m["a"])({},Object(A["b"])(["activeStreams"]))},D=N,P=(n("5c0b"),Object(w["a"])(D,p,d,!1,null,null,null)),L=P.exports,H=n("8c4f"),B=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page sign-in flex-grow-1"},[n("app-main-header"),n("div",{},[n("div",{staticClass:"w-100 h-100 d-flex justify-content-center align-items-center"},[n("app-login-form")],1)]),n("app-main-footer")],1)},F=[],z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.show?n("b-form",{staticClass:"h-100 w-100 d-flex flex-column justify-content-center align-items-stretch",on:{submit:e.onSubmit,reset:e.onReset}},[n("b-form-group",{attrs:{id:"input-group-2",label:"Your Name:","label-for":"input-2"}},[n("b-form-input",{attrs:{id:"input-2",placeholder:"Enter name",required:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),n("div",{staticClass:"my-1 buttons d-flex"},[n("b-button",{staticClass:"col-5",attrs:{type:"reset",variant:"danger"}},[e._v("Reset")]),n("b-button",{staticClass:"offset-2 col-5",attrs:{type:"submit",variant:"primary"}},[e._v("Sign In")])],1)],1):e._e()},q=[],G=(n("96cf"),n("1da1")),Y="".concat(window.location.origin,"/api"),W=("".concat(Y,"/users/login"),"".concat(Y,"/users/register"),3e3),J=(n("fb6a"),n("b680"),n("d3b7"),n("cfc3"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("d4ec")),Q=n("bee2"),K=(n("3ca3"),n("fd87"),n("8b09"),n("ddb0"),n("2b3d"),n("db3f")),X=function(){function e(t){Object(J["a"])(this,e),this.bitRate=t.bitRate,this.sampleRate=t.sampleRate,this.dataBuffer=[],this.encoder=new K["Mp3Encoder"](1,this.sampleRate,this.bitRate)}return Object(Q["a"])(e,[{key:"encode",value:function(e){for(var t=1152,n=this._convertBuffer(e),r=n.length,a=0;r>=0;a+=t){var s=n.subarray(a,a+t),i=this.encoder.encodeBuffer(s);this.dataBuffer.push(new Int8Array(i)),r-=t}}},{key:"finish",value:function(){this.dataBuffer.push(this.encoder.flush());var e=new Blob(this.dataBuffer,{type:"audio/mp3"});return this.dataBuffer=[],{id:Date.now(),blob:e,url:URL.createObjectURL(e)}}},{key:"_floatTo16BitPCM",value:function(e,t){for(var n=0;n<e.length;n+=1){var r=Math.max(-1,Math.min(1,e[n]));t[n]=r<0?32768*r:32767*r}}},{key:"_convertBuffer",value:function(e){var t=new Float32Array(e),n=new Int16Array(e.length);return this._floatTo16BitPCM(t,n),n}}]),e}(),Z=(n("c19f"),n("4a9b"),function(){function e(t){Object(J["a"])(this,e),this.bufferSize=t.bufferSize||4096,this.sampleRate=t.sampleRate,this.samples=t.samples}return Object(Q["a"])(e,[{key:"finish",value:function(){this._joinSamples();var e=new ArrayBuffer(44+2*this.samples.length),t=new DataView(e);this._writeString(t,0,"RIFF"),t.setUint32(4,36+2*this.samples.length,!0),this._writeString(t,8,"WAVE"),this._writeString(t,12,"fmt "),t.setUint32(16,16,!0),t.setUint16(20,1,!0),t.setUint16(22,1,!0),t.setUint32(24,this.sampleRate,!0),t.setUint32(28,4*this.sampleRate,!0),t.setUint16(32,4,!0),t.setUint16(34,16,!0),this._writeString(t,36,"data"),t.setUint32(40,2*this.samples.length,!0),this._floatTo16BitPCM(t,44,this.samples);var n=new Blob([t],{type:"audio/wav"});return{id:Date.now(),blob:n,url:URL.createObjectURL(n)}}},{key:"_floatTo16BitPCM",value:function(e,t,n){for(var r=t,a=0;a<n.length;a+=1,r+=2){var s=Math.max(-1,Math.min(1,n[a]));e.setInt16(r,s<0?32768*s:32767*s,!0)}}},{key:"_joinSamples",value:function(){for(var e=this.samples.length*this.bufferSize,t=new Float64Array(e),n=0,r=0;r<this.samples.length;r+=1){var a=this.samples[r];t.set(a,n),n+=a.length}this.samples=t}},{key:"_writeString",value:function(e,t,n){for(var r=0;r<n.length;r+=1)e.setUint8(t+r,n.charCodeAt(r))}}]),e}()),ee=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(J["a"])(this,e),this.micFailed=t.micFailed,this.format=t.format?t.format:"mp3",this.encoderOptions={bitRate:t.bitRate?t.bitRate:128,sampleRate:t.sampleRate?t.sampleRate:44100},this.bufferSize=4096,this.record=null,this.isPause=!1,this.isRecording=!1,this.duration=0,this.volume=0,this.wavSamples=[],this._duration=0}return Object(Q["a"])(e,[{key:"start",value:function(){var e={video:!1,audio:{channelCount:1,echoCancellation:!1}};navigator.mediaDevices.getUserMedia(e).then(this._micCaptured.bind(this)).catch(this._micError.bind(this)),this.isPause=!1,this.isRecording=!0,this._isMp3()&&!this.lameEncoder&&(this.lameEncoder=new X(this.encoderOptions))}},{key:"_setStateStopped",value:function(){this._duration=0,this.duration=0,this.isPause=!1,this.isRecording=!1}},{key:"stop",value:function(){if(this.stream){this.stream.getTracks().forEach((function(e){return e.stop()})),this.input.disconnect(),this.processor.disconnect(),this.context.close();var e=null;if(this._isMp3())e=this.lameEncoder.finish();else{var t=new Z({bufferSize:this.bufferSize,sampleRate:this.encoderOptions.sampleRate,samples:this.wavSamples});e=t.finish(),this.wavSamples=[]}e.type=this.format,e.size=e.blob.size,e.duration=g(this.duration),this.record=e,this._setStateStopped()}else this._setStateStopped()}},{key:"pause",value:function(){this.stream?(this.stream.getTracks().forEach((function(e){return e.stop()})),this.input.disconnect(),this.processor.disconnect(),this._duration=this.duration,this.isPause=!0):this._setStateStopped()}},{key:"_micCaptured",value:function(e){var t=this;this.context=new(window.AudioContext||window.webkitAudioContext),this.duration=this._duration,this.input=this.context.createMediaStreamSource(e),this.processor=this.context.createScriptProcessor(this.bufferSize,1,1),this.stream=e,this.processor.onaudioprocess=function(e){var n=e.inputBuffer.getChannelData(0),r=0;t._isMp3()?t.lameEncoder.encode(n):t.wavSamples.push(new Float32Array(n));for(var a=0;a<n.length;a+=1)r+=n[a]*n[a];var s=parseFloat(t.context.currentTime.toFixed(2));t.duration=parseFloat(t._duration)+s,t.volume=Math.sqrt(r/n.length).toFixed(2)},this.input.connect(this.processor),this.processor.connect(this.context.destination)}},{key:"_micError",value:function(e){this.isPause=!1,this.isRecording=!1,this.record=void 0,console.debug("mic failed!"),this.micFailed&&this.micFailed(e)}},{key:"_isMp3",value:function(){return"mp3"===this.format.toLowerCase()}}]),e}(),te={state:function(){return{recorder:void 0,currentRecord:void 0,isRecording:!1,isPlaying:!1,startPlay:"",playerSource:"",playedTime:"",playerDuration:""}},mutations:{initRecorder:function(e,t){e.recorder=new ee(t)},saveRecord:function(e,t){e.currentRecord=t},setRecorderState:function(e,t){e.isRecording=t},setPlayerState:function(e,t){e.isPlaying=t},setPlayerTime:function(e,t){e.playedTime=t},setPlayerDuration:function(e,t){e.playerDuration=t},setPlayerSource:function(e,t){e.playerSource="string"===typeof t?t.slice():t},startPlay:function(e,t){e.startPlay="string"===typeof t?t.slice():t},stopPlay:function(e){e.startPlay=void 0},startStopPlay:function(e,t){e.startPlay="string"===typeof t?t.slice():t}},getters:{audioSource:function(e){return e.currentRecord?e.currentRecord.url:""}}},ne=(n("b0c0"),n("4fad"),n("2909")),re=n("3835"),ae="VoiceHouse",se="entry",ie="home",oe=["signIn","signUp","entry"],ce=function(){return{mainTitle:ae,online:!1,draft:{},unreadMessages:{},historyLoaded:{},notification:void 0,attachedFiles:[],footerLinks:{home:[],room:[]},currentRoute:void 0,previousRoute:void 0}},ue={state:ce,mutations:{pushRoute:function(e,t){e.previousRoute=Object(m["a"])({},e.currentRoute),e.currentRoute=Object(m["a"])({},t)},updateDraft:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.draft[e.currentChatId]=t.slice(),e.draft=Object(m["a"])({},e.draft)},deleteDraft:function(e,t){e.draft[t]="",e.draft=Object(m["a"])({},e.draft)},setUnreadMessagesCount:function(e,t){var n=t.count,r=t.chat,a=Object(m["a"])({},e.unreadMessages);a[r]=n,e.unreadMessages=a},addUnreadMessage:function(e,t){var n=Object(m["a"])({},e.unreadMessages);n[t]?n[t]+=1:n[t]=1,e.unreadMessages=n},setToDefaultsAll:function(e){var t=ce();Object.entries(t).forEach((function(t){var n=Object(re["a"])(t,2),r=n[0],a=n[1];e[r]=a}))},setHistoryLoaded:function(e,t){var n=Object(m["a"])({},e.historyLoaded);n[t]=!0,e.historyLoaded=n},updateLinkStatus:function(e,t){e.online=t},postNotification:function(e,t){e.notification=Object(m["a"])({},t)},setAttachedFiles:function(e,t){e.attachedFiles=t instanceof Array?Object(ne["a"])(t):[]}},getters:{isChatOpened:function(e){return!!e.currentRoute&&"chat"===e.currentRoute.name},isRoomOpened:function(e){return!!e.currentRoute&&("chat"===e.currentRoute.name||"room"===e.currentRoute.name)},currentRoute:function(e){return e.currentRoute?Object(m["a"])({},e.currentRoute):e.currentRoute},previousRoute:function(e){return e.previousRoute?Object(m["a"])({},e.previousRoute):e.previousRoute},mainTitle:function(e){return e.mainTitle},isSystemOnline:function(e){return e.online},unreadMessagesByChatId:function(e){return function(t){return e.unreadMessages[t]}},currentDraft:function(e,t){return e.draft[t.currentChatId]},isHistoryFull:function(e,t){return!!e.historyLoaded[t.currentChatId]}},actions:{clearUnreadMessagesCount:function(e){var t=e.commit,n=e.getters;t("setUnreadMessagesCount",{chat:n.currentChatId,count:0})}}},le=(n("99af"),n("7db0"),n("0481"),n("c975"),n("45fc"),n("4069"),n("07ac"),n("c740"),n("caad"),n("d81d"),n("a434"),n("2532"),function(){return{voiceChannels:{},currentVoiceChannelId:void 0,inputStreams:[],contactVoiceStates:{}}}),he={state:le,mutations:{setContactVoiceState:function(e,t){var n=t.contact,r=t.value,a=Object(m["a"])({},e.contactVoiceStates);a[n]=r,e.contactVoiceStates=a},setCurrentVoiceChannel:function(e,t){t&&(e.currentVoiceChannelId=t.slice()),e.currentVoiceChannelId=t},updateVoiceChannels:function(e,t){e.voiceChannels=Object(m["a"])({},t)},addVoiceChannel:function(e,t){var n=t.virtualServer,r=t.voiceChannel,a=Object(m["a"])({},e.voiceChannels);a[n]||(a[n]=[]),a[n].push(r),e.voiceChannels=a},deleteVoiceChannel:function(e,t){var n=t.virtualServer,r=t.voiceChannelId;e.voiceChannels[n]&&(e.voiceChannels[n]=e.voiceChannels[n].filter((function(e){return e._id!==r})),e.voiceChannels=Object(m["a"])({},e.voiceChannels))},setToDefaultsAll:function(e){var t=le();Object.entries(t).forEach((function(t){var n=Object(re["a"])(t,2),r=n[0],a=n[1];e[r]=a}))},setContactStream:function(e,t){var n=t.contact,r=t.stream,a=Object(ne["a"])(e.inputStreams),s=a.find((function(e){return e.contact===n}));s?s.stream=r:a.push({contact:n,stream:r}),e.inputStreams=a,console.log("input streams ",e.inputStreams)},deleteContactStream:function(e,t){var n=Object(ne["a"])(e.inputStreams),r=n.findIndex((function(e){return e.contact===t}));-1!==r&&n.splice(r,1),e.inputStreams=n}},getters:{freeUsers:function(e,t){var n=t.currentVirtualServerStatus.filter((function(e){return e.value&&e.value.voiceChannel})).map((function(e){return e.user})),r=t.contactsOnlineOfCurrentServer;return r?r.filter((function(e){return!n.some((function(t){return t===e._id}))})):[]},getContactVoiceState:function(e){return function(t){return!!e.contactVoiceStates[t]}},voiceChannelById:function(e){return function(t){return Object.values(e.voiceChannels).flat().find((function(e){return e._id===t}))}},currentVoiceChannelId:function(e){return e.currentVoiceChannelId},contactsWithStreams:function(e){return e.inputStreams},activeStreams:function(e){return e.inputStreams.map((function(e){return e.stream}))},voiceChannelsByCurrentVirtualServer:function(e,t){var n=t.currentVirtualServerId;if(!n)return[];var r=e.voiceChannels[n];return r||[]},currentVoiceChannel:function(e,t){if(e.voiceChannels[t.currentVirtualServerId]){var n=e.voiceChannels[t.currentVirtualServerId].find((function(t){return t._id===e.currentVoiceChannelId}));return n?Object(m["a"])({},n):n}},voiceChannelStatus:function(e,t){return function(e){var n=t.currentVirtualServerStatus;return n?(n=n.filter((function(t){return t.value.voiceChannel===e})).map((function(e){return e.user})),n):[]}},currentVoiceChannelStatus:function(e,t){return t.voiceChannelStatus(t.currentVirtualServerId)},getVoiceChannelContacts:function(e,t){return function(e){return t.currentVirtualServerStatus.filter((function(t){return t.value&&t.value.voiceChannel===e})).map((function(e){return e.user})).map((function(e){return t.userById(e)}))}}},actions:{deleteVoiceChannel:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a,s,i,o,c,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.commit,a=e.dispatch,s=e.getters,i=t.virtualServer,o=t.voiceChannelId,s.currentVoiceChannelId===o&&a("disconnectFromVoiceChannel"),c=s.voiceChannelById(o),c){n.next=6;break}return n.abrupt("return");case 6:return u=c.chat,n.next=9,a("deleteChat",{virtualServer:i,chat:u});case 9:r("deleteVoiceChannel",{virtualServer:i,voiceChannelId:o});case 10:case"end":return n.stop()}}),n)})))()},setCurrentVoiceChannel:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=e.commit,r("setCurrentVoiceChannel",t);case 2:case"end":return n.stop()}}),n)})))()},updateStreamsByContactsOnline:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.state,a=e.dispatch,r.inputStreams.length){n.next=3;break}return n.abrupt("return");case 3:return s=r.inputStreams.filter((function(e){return!t.includes(e.contact)})),r.inputStreams=r.inputStreams.filter((function(e){return t.includes(e.contact)})),n.next=7,Promise.all(s.map((function(e){return a("disconnectContact",e.contact)})));case 7:case"end":return n.stop()}}),n)})))()}}},fe=n("66e8"),pe=function(){return{status:{},userStatus:{chat:void 0,voiceChannel:void 0,muted:!1,role:fe["VOICE_CHANNEL_USER_ROLES"].listener}}},de={state:pe,mutations:{updateStatus:function(e,t){var n=t.virtualServer,r=t.status,a=Object(m["a"])({},e.status);a[n]=r,e.status=Object(m["a"])({},a)},updateUserStatus:function(e,t){e.userStatus=t?Object(m["a"])({},t):t},updateUserChatStatus:function(e,t){var n=Object(m["a"])({},e.userStatus);n.chat=t,e.userStatus=n},updateUserVoiceChannelStatus:function(e,t){var n=Object(m["a"])({},e.userStatus);n.voiceChannel=t,e.userStatus=n},updateUserMutedStatus:function(e,t){var n=Object(m["a"])({},e.userStatus);n.muted=t,e.userStatus=n},updateUserRoleStatus:function(e,t){var n=Object(m["a"])({},e.userStatus);n.role=t,e.userStatus=n},setToDefaultsAll:function(e){var t=pe();Object.entries(t).forEach((function(t){var n=Object(re["a"])(t,2),r=n[0],a=n[1];e[r]=a}))}},getters:{currentChatStatus:function(e,t){var n=t.currentVirtualServerStatus.filter((function(e){return e.value.chat===t.currentChatId})).map((function(e){return e.user}));return n},currentVirtualServerStatus:function(e,t){return e.status[t.currentVirtualServerId]?e.status[t.currentVirtualServerId]:[]},userStatus:function(e){return e.userStatus},userChatStatus:function(e){return e.userStatus.chat},currentUserMutedStatus:function(e){return e.userStatus.muted},userRole:function(e){return e.userStatus.role?e.userStatus.role:fe["VOICE_CHANNEL_USER_ROLES"].listener},isSpeaker:function(e,t){return t.userRole===fe["VOICE_CHANNEL_USER_ROLES"].speaker},getMutedByUserId:function(e,t){return function(e){var n=t.currentVirtualServerStatus.find((function(t){return t.user===e}));return!n||!n.value||void 0===n.value.muted||n.value.muted}},getRoleByUserId:function(e,t){return function(e){var n=t.currentVirtualServerStatus.find((function(t){return t.user===e}));return n&&n.value&&n.value.role?n.value.role:fe["VOICE_CHANNEL_USER_ROLES"].listener}},speakers:function(e,t){return t.currentVirtualServerStatus.filter((function(e){return e.value&&e.value.voiceChannel===t.currentVoiceChannelId})).filter((function(e){return e.value.role===fe["VOICE_CHANNEL_USER_ROLES"].speaker})).map((function(e){return e.user})).map((function(e){return t.userById(e)}))},listeners:function(e,t){return t.currentVirtualServerStatus.filter((function(e){return e.value&&e.value.voiceChannel===t.currentVoiceChannelId})).filter((function(e){return e.value.role===fe["VOICE_CHANNEL_USER_ROLES"].listener})).map((function(e){return e.user})).map((function(e){return t.userById(e)}))}},actions:{updateStatus:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a,s,i,o,c,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.commit,a=e.dispatch,s=e.getters,i=t.virtualServer,o=t.status,r("updateStatus",{virtualServer:i,status:o}),c=o.find((function(e){return e.user===s.user._id})),!c||!c.value){n.next=7;break}return n.next=7,a("setCurrentVoiceChannel",c.value.voiceChannel);case 7:return u=o.filter((function(e){return e.value.voiceChannel===c.value.voiceChannel})).map((function(e){return e.user})),n.next=10,a("updateStreamsByContactsOnline",u);case 10:case"end":return n.stop()}}),n)})))()},updateUserChatStatus:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.commit,a=e.dispatch,r("updateUserChatStatus",t),n.next=4,a("sendUserStatus");case 4:case"end":return n.stop()}}),n)})))()},updateUserVoiceChannelStatus:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.commit,a=e.dispatch,r("updateUserVoiceChannelStatus",t),n.next=4,a("sendUserStatus");case 4:case"end":return n.stop()}}),n)})))()},updateUserMutedStatus:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.commit,a=e.dispatch,r("updateUserMutedStatus",t),n.next=4,a("sendUserStatus");case 4:case"end":return n.stop()}}),n)})))()},updateUserStatus:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.commit,a=e.dispatch,r("updateUserStatus",t),n.next=4,a("sendUserStatus");case 4:case"end":return n.stop()}}),n)})))()},updateUserRole:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.commit,a=e.dispatch,r("updateUserRoleStatus",t),n.next=4,a("sendUserStatus");case 4:case"end":return n.stop()}}),n)})))()},setUserRoleToDefault:function(e){return Object(G["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.commit,r=e.dispatch,n("updateUserRoleStatus",fe["VOICE_CHANNEL_USER_ROLES"].listener),t.next=4,r("sendUserStatus");case 4:case"end":return t.stop()}}),t)})))()}}},me=function(){return{user:void 0,token:void 0,virtualServers:{},chats:{},chatHistory:[],contacts:[],contactsOnline:{},currentVirtualServerId:void 0,currentChatId:void 0}},ve={state:me,mutations:{setCurrentVirtualServer:function(e,t){e.currentVirtualServerId!==t&&(e.currentVirtualServerId=t.slice(),e.currentChatId=e.chats[t].length?e.chats[t][0]._id.slice():void 0)},setCurrentChat:function(e,t){e.currentChatId=t?t.slice():t},setVirtualServers:function(e,t){var n={};t.forEach((function(e){n[e._id]=Object(m["a"])({},e)})),e.virtualServers=n},setChats:function(e,t){e.chats=Object(m["a"])({},t)},saveUser:function(e,t){e.user=Object(m["a"])({},t)},saveToken:function(e,t){"string"===typeof t&&(e.token=t.slice())},updateChats:function(e,t){e.chats=Object(m["a"])({},t)},addChat:function(e,t){var n=t.virtualServer,r=t.chat,a=Object(m["a"])({},e.chats);a[n]||(a[n]=[]),a[n].push(r),e.chats=a},deleteChat:function(e,t){var n=t.virtualServer,r=t.chatId;e.chats[n]&&(e.chats[n]=e.chats[n].filter((function(e){return e._id!==r})),e.chats=Object(m["a"])({},e.chats))},updateChatHistory:function(e,t){e.chatHistory=Object(ne["a"])(t)},addChatHistoryChunk:function(e,t){if(t.length){var n=e.chatHistory.concat(t);e.chatHistory=n}},addMessage:function(e,t){var n=Object(ne["a"])(e.chatHistory);n.unshift(t),e.chatHistory=n},updateContactsOnline:function(e,t){var n=t.virtualServer,r=t.contactsOnline,a=Object(m["a"])({},e.contactsOnline);a[n]=r,e.contactsOnline=a;var s=Object.values(a).flat();s=s.filter((function(e,t){return s.indexOf(e)===t})),s=s.filter((function(t){return!e.contacts.some((function(e){return e._id===t._id}))})),s.length&&(s=e.contacts.concat(s),e.contacts=Object(ne["a"])(s))},updateContacts:function(e,t){e.contacts=Object(ne["a"])(t)},setToDefaultsAll:function(e){var t=me();Object.entries(t).forEach((function(t){var n=Object(re["a"])(t,2),r=n[0],a=n[1];e[r]=a}))}},getters:{contactsOnlineOfCurrentServer:function(e){return e.contactsOnline[e.currentVirtualServerId]},user:function(e){return e.user},currentVirtualServerId:function(e){return e.currentVirtualServerId},currentChatId:function(e){return e.currentChatId},usersOnline:function(e){return e.contactsOnline[e.currentVirtualServerId]},chatsByCurrentVirtualServer:function(e){if(!e.currentVirtualServerId)return[];var t=e.chats[e.currentVirtualServerId];return t||[]},isLoggedIn:function(e){return!!e.user},currentChat:function(e){var t=e.chats[e.currentChatId];return Object(m["a"])({},t)},currentVirtualServer:function(e){return e.virtualServers[e.currentVirtualServerId]},currentChatHistory:function(e){var t=e.chatHistory.filter((function(t){return t.chat===e.currentChatId}));return t?t.reverse():[]},currentHistorySize:function(e,t){return t.currentChatHistory.length},usernameById:function(e){return function(t){var n=e.contacts.find((function(e){return e._id===t}));return n?n.username:""}},userById:function(e){return function(t){return e.contacts.find((function(e){return e._id===t}))}}},actions:{addMessage:function(e,t){var n=e.commit,r=e.getters;n("addMessage",t),n("addUnreadMessage",t.chat),r.isChatOpened||t.chat!==r.currentChatId||n("postNotification",{title:"Room ".concat(r.currentVoiceChannel.name," : "),message:"".concat(r.userById(t.user).username," : ").concat(t.text)})},deleteChat:function(e,t){var n=e.commit,r=e.getters;r.currentChatId===t&&n("setCurrentChat",void 0),n("deleteChat",t)},setCurrentVirtualServer:function(e,t){var n=e.commit;n("setCurrentVirtualServer",t),n("setAttachedFiles",[]),n("saveRecord",void 0)},setCurrentChat:function(e,t){var n=e.commit;n("setCurrentChat",t),n("setAttachedFiles",[]),n("saveRecord",void 0)},saveUser:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=e.commit,r("saveUser",t.user),r("saveToken",t.token),r("setVirtualServers",t.virtualServers);case 4:case"end":return n.stop()}}),n)})))()}},modules:{voiceChannel:he,status:de}},be=(n("b64b"),n("ac1f"),n("5319"),n("68cb")),ge=n.n(be),Ce=function(){function e(t){var n=t.options,r=void 0===n?{}:n,a=t.onSpeaking,s=void 0===a?function(){}:a,i=t.onStoppedSpeaking,o=void 0===i?function(){}:i;Object(J["a"])(this,e),this.voiceActivityDetector=ge.a,this.eventEmitter=void 0,this.onSpeaking=s,this.onStoppedSpeaking=o,this.options=r}return Object(Q["a"])(e,[{key:"startListeningStream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options;this.eventEmitter=this.voiceActivityDetector(e,t),this.eventEmitter.on("speaking",this.onSpeaking),this.eventEmitter.on("stopped_speaking",this.onStoppedSpeaking)}},{key:"stopListening",value:function(){this.eventEmitter.stop(),this.eventEmitter=void 0}},{key:"isListening",get:function(){return!!this.eventEmitter}}]),e}(),ke=function(){function e(t,n,r){var a=this;Object(J["a"])(this,e),this.voiceChannel=r,this.contact=n,this.inputStream=void 0,this.iceQueue=[],this.createPeerConnection(t,this.voiceChannel.connectionConfig),this.voiceDetector=new Ce({onSpeaking:function(){a.voiceChannel.onVoiceDetectionEvent({value:!0,contact:a.contact})},onStoppedSpeaking:function(){a.voiceChannel.onVoiceDetectionEvent({value:!1,contact:a.contact})}})}return Object(Q["a"])(e,[{key:"createPeerConnection",value:function(e,t){var n=this;this.peerConnection=new RTCPeerConnection(t),this.peerConnection.onicecandidate=function(e){null!==e.candidate&&n.voiceChannel.sendIce(n.contact,e.candidate)},this.peerConnection.ontrack=function(e){n.inputStream||(n.inputStream=new MediaStream),e.track&&(n.inputStream.addTrack(e.track),n.voiceDetector.isListening||n.voiceDetector.startListeningStream(n.inputStream),n.voiceChannel.onInputStream(n.contact,n.inputStream))},e.getTracks().forEach((function(e){n.peerConnection.addTrack(e)}))}},{key:"connectToClient",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,!t){e.next=6;break}return e.next=4,this.onOffer(t,n);case 4:e.next=18;break;case 6:return e.next=8,this.peerConnection.createOffer();case 8:return r=e.sent,e.next=11,this.peerConnection.setLocalDescription(r);case 11:return e.next=13,this.voiceChannel.sendOffer(this.contact,r);case 13:if(a=e.sent,a.answer){e.next=16;break}throw new Error("No answer from voice channel client!");case 16:return e.next=18,this.onAnswer(a.answer);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e["catch"](0),this.voiceChannel.onError(e.t0);case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){if(this.voiceDetector.stopListening(),this.voiceChannel.onCloseConnection(),this.peerConnection.close(),this.inputStream){var e=this.inputStream.getTracks();e.forEach((function(e){e.stop()})),this.inputStream=void 0}}},{key:"onOffer",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.peerConnection.setRemoteDescription(new RTCSessionDescription(t));case 2:return e.next=4,this.peerConnection.createAnswer();case 4:return r=e.sent,e.next=7,this.peerConnection.setLocalDescription(r);case 7:return e.next=9,this.voiceChannel.sendAnswer(this.contact,r,n);case 9:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"onAnswer",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.peerConnection.setRemoteDescription(new RTCSessionDescription(t));case 2:if(!this.iceQueue.length){e.next=7;break}return n=Promise.resolve(),this.iceQueue.forEach((function(e){n=n.then((function(){return r.onIce(e,!0)}))})),e.next=7,n;case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onIce",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t){var n,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]&&r[1],this.peerConnection&&this.peerConnection.remoteDescription&&this.peerConnection.remoteDescription.type){e.next=4;break}return n||this.iceQueue.push(t),e.abrupt("return",!1);case 4:return e.next=6,this.peerConnection.addIceCandidate(new RTCIceCandidate(t));case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),we=n("66e8"),Se=we.ICE_SERVER_URLS,ye=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{iceServers:[{urls:Se}]},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){},o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:function(){},c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:function(){};Object(J["a"])(this,e),this.connectionConfig=t,this.sendOffer=r.bind(void 0,this.virtualServer,this.voiceChannel),this.sendIce=n.bind(void 0,this.virtualServer,this.voiceChannel),this.sendAnswer=a.bind(void 0,this.virtualServer,this.voiceChannel),this.onInputStream=s,this.onCloseConnection=i,this.onError=o,this.onVoiceDetectionEvent=c,this.connections=[],this.mediaStream=void 0,this.microphoneState=!0}return Object(Q["a"])(e,[{key:"setUser",value:function(e){this.user=e}},{key:"switchMicrophone",value:function(e){return this.microphoneState=void 0!==e?e:!this.microphoneState,!this.microphoneTrack||(this.microphoneTrack.enabled=this.microphoneState,this.microphoneState)}},{key:"createConnection",value:function(e){var t=new ke(this.mediaStream,e,this);return this.connections.push(t),t}},{key:"connectToChannel",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){var r,a=this,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=s.length>2&&void 0!==s[2]?s[2]:[],this.virtualServer=t,this.voiceChannel=n,r&&r.length){e.next=5;break}return e.abrupt("return",!0);case 5:return e.prev=5,e.next=8,this.createMediaStream();case 8:return r.forEach((function(e){a.createConnection(e)})),e.next=11,Promise.all(this.connections.map((function(e){return e.connectToClient()})));case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e["catch"](5),this.onError(e.t0),e.abrupt("return",!1);case 17:return e.abrupt("return",!0);case 18:case"end":return e.stop()}}),e,this,[[5,13]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"disconnect",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.connections.forEach((function(e){e.close()})),this.connections=[],this.mediaStream&&(this.voiceDetector.stopListening(),t=this.mediaStream.getTracks(),t.forEach((function(e){e.stop()})),this.mediaStream=void 0);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onContactDisconnect",value:function(e){var t=this.connections.findIndex((function(t){return t.contact===e}));if(-1!==t){var n=this.connections[t];n.close(),this.connections.splice(t,1)}}},{key:"createMediaStream",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.mediaStream){e.next=2;break}return e.abrupt("return",!0);case 2:return e.prev=2,e.next=5,navigator.mediaDevices.getUserMedia({video:!1,audio:!0});case 5:this.mediaStream=e.sent,this.switchMicrophone(this.microphoneState),this.voiceDetector=new Ce({onSpeaking:function(){t.onVoiceDetectionEvent({value:!0,contact:t.user._id})},onStoppedSpeaking:function(){t.onVoiceDetectionEvent({value:!1,contact:t.user._id})}}),this.voiceDetector.startListeningStream(this.mediaStream),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](2),this.onError(e.t0),this.mediaStream=null;case 15:return e.abrupt("return",!!this.mediaStream);case 16:case"end":return e.stop()}}),e,this,[[2,11]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"onOffer",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,s,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=n.voiceChannel,a=n.user,s=n.offer,i=n.uniqueMessageId,this.virtualServer&&(this.virtualServer=t,this.voiceChannel=r),e.prev=2,e.next=5,this.createMediaStream();case 5:return o=this.createConnection(a),e.next=8,o.connectToClient(s,i);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),this.onError(e.t0);case 13:case"end":return e.stop()}}),e,this,[[2,10]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"onIce",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.user,r=t.ice,a=this.getConnectionByContact(n),e.prev=2,!a){e.next=6;break}return e.next=6,a.onIce(r);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](2),this.onError(e.t0);case 11:case"end":return e.stop()}}),e,this,[[2,8]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getConnectionByContact",value:function(e){return this.connections.find((function(t){return t.contact===e}))}},{key:"microphoneTrack",get:function(){if(this.mediaStream){var e=this.mediaStream.getAudioTracks();if(e||e.length)return e[0]}}},{key:"microphoneMuted",get:function(){return this.microphoneTrack?!this.microphoneTrack.enabled:!this.microphoneState}}]),e}(),xe=function(){function e(t){Object(J["a"])(this,e),this.token=t}return Object(Q["a"])(e,[{key:"initToken",value:function(e){this.token=e}},{key:"status",value:function(e){return{status:e,token:this.token,action:fe["ACTIONS"].status}}},{key:"text",value:function(e,t){return{text:t,chat:e,token:this.token,action:fe["ACTIONS"].text}}},{key:"binaryInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fe["ACTIONS"].audioInfo;return{binaryInfo:e,token:this.token,action:t}}},{key:"messageHeader",value:function(e,t){return{text:t.text,chat:e,token:this.token,action:fe["ACTIONS"].messageHeader}}},{key:"messageFooter",value:function(){return{token:this.token,action:fe["ACTIONS"].messageFooter}}},{key:"historyRequest",value:function(e,t){return{offset:t,chat:e,token:this.token,action:fe["ACTIONS"].getHistory}}},{key:"chatsRequest",value:function(){return{token:this.token,action:fe["ACTIONS"].getChats}}},{key:"voiceChannelsRequest",value:function(){return{token:this.token,action:fe["ACTIONS"].getVoiceChannels}}},{key:"createVoiceChannel",value:function(e){return{name:e,token:this.token,action:fe["ACTIONS"].createVoiceChannel}}},{key:"deleteVoiceChannel",value:function(e){return{voiceChannelId:e,token:this.token,action:fe["ACTIONS"].deleteVoiceChannel}}},{key:"contactsRequest",value:function(){return{token:this.token,action:fe["ACTIONS"].getContacts}}},{key:"offer",value:function(e,t,n){return{voiceChannel:e,offer:n,token:this.token,action:fe["ACTIONS"].voiceChannelOffer,to:t}}},{key:"answer",value:function(e,t,n,r){return{uniqueMessageId:r,voiceChannel:e,answer:n,token:this.token,action:fe["ACTIONS"].voiceChannelAnswer,to:t}}},{key:"ice",value:function(e,t,n){return{voiceChannel:e,ice:n,token:this.token,action:fe["ACTIONS"].voiceChannelIce,to:t}}}]),e}(),je=n("262e"),Oe=n("2caf"),Re=n("9072"),_e=function(e){Object(je["a"])(n,e);var t=Object(Oe["a"])(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Internal client Error",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return Object(J["a"])(this,n),e=t.call(this,r),e.shortMsg=r,e.responseStatus=a,e}return n}(Object(Re["a"])(Error)),Ee=function(e){Object(je["a"])(n,e);var t=Object(Oe["a"])(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Error on server! Message was not sent",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:401;return Object(J["a"])(this,n),t.call(this,e,r)}return n}(_e);function Ie(){this.messageGenerator=new xe,this.initializeRequestInterface=function(e){this.messageGenerator.initToken(e)},this.getAllChats=Object(G["a"])(regeneratorRuntime.mark((function e(){var t,n,r,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all(this.virtualServers.map((function(e){return a.getChats(e)})));case 3:return t=e.sent,n=t.flat(),r={},n.forEach((function(e){r[e.virtualServer]||(r[e.virtualServer]=[]),r[e.virtualServer].push(e)})),e.abrupt("return",r);case 10:return e.prev=10,e.t0=e["catch"](0),e.abrupt("return",{});case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),this.getAllVoiceChannels=Object(G["a"])(regeneratorRuntime.mark((function e(){var t,n,r,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all(this.virtualServers.map((function(e){return a.getVoiceChannels(e)})));case 3:return t=e.sent,n=t.flat(),r={},n.forEach((function(e){var t=e.virtualServer;r[t]||(r[t]=[]),r[t].push(e)})),e.abrupt("return",r);case 10:return e.prev=10,e.t0=e["catch"](0),e.abrupt("return",{});case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),this.getAllHistory=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all(t.map((function(e){return r.getHistory(e.virtualServer,e._id,0)})));case 3:if(n=e.sent,n){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",n.flat());case 9:return e.prev=9,e.t0=e["catch"](0),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),this.sendFullMessage=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n,r){var a,s,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r.audio||r.files){e.next=2;break}return e.abrupt("return",this.sendText(t,n,r.text));case 2:return e.prev=2,e.next=5,this.sendMessageHeader(t,n,r);case 5:if(a=e.sent,!a.error){e.next=8;break}return e.abrupt("return",void 0);case 8:if(!r.audio){e.next=11;break}return e.next=11,this.sendAudio(t,r.audio);case 11:if(!r.files){e.next=16;break}return s=Promise.resolve(),r.files.forEach((function(e){s=s.then((function(){return i.sendFile(t,e)}))})),e.next=16,s;case 16:return e.abrupt("return",this.sendMessageFooter(t));case 19:return e.prev=19,e.t0=e["catch"](2),e.abrupt("return",void 0);case 22:case"end":return e.stop()}}),e,this,[[2,19]])})));return function(t,n,r){return e.apply(this,arguments)}}(),this.sendFile=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=Object(m["a"])({},n),delete r.file,e.abrupt("return",this.sendBinary(t,r,n.file,fe["ACTIONS"].fileInfo));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),this.sendAudio=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=Object(m["a"])({},n),delete r.audio,e.abrupt("return",this.sendBinary(t,r,n.audio,fe["ACTIONS"].audioInfo));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),this.sendBinary=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n,r){var a,s,i,o,c=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=c.length>3&&void 0!==c[3]?c[3]:fe["ACTIONS"].audioInfo,e.next=3,this.sendBinaryInfo(t,n,a);case 3:if(s=e.sent,!s.error){e.next=6;break}throw new Ee;case 6:if(i=this.getClient(t),i){e.next=9;break}throw new Ee;case 9:return e.next=11,i.socket.sendBinaryAsync(r);case 11:if(o=e.sent,!o.error){e.next=14;break}throw new Ee;case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.sendBinaryInfo=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:fe["ACTIONS"].audioInfo,a=this.messageGenerator.binaryInfo(n,r),e.abrupt("return",this.sendMessageAsync(t,a));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),this.sendMessageHeader=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=this.messageGenerator.messageHeader(n,r),e.abrupt("return",this.sendMessageAsync(t,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.sendMessageFooter=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=this.messageGenerator.messageFooter(),e.abrupt("return",this.sendMessageAsync(t,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.sendStatus=function(e,t){var n=this.messageGenerator.status(t);this.sendMessage(e,n)},this.sendText=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=this.messageGenerator.text(n,r),e.abrupt("return",this.sendMessageAsync(t,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.getHistory=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n,r){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=this.messageGenerator.historyRequest(n,r),e.next=3,this.sendMessageAsync(t,a);case 3:if(s=e.sent,s){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",s.history);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.getChats=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=this.messageGenerator.chatsRequest(),e.next=3,this.sendMessageAsync(t,n);case 3:if(r=e.sent,r){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",r.chats);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.getVoiceChannels=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=this.messageGenerator.voiceChannelsRequest(),e.next=3,this.sendMessageAsync(t,n);case 3:if(r=e.sent,r){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",r.voiceChannels);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.createVoiceChannel=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=this.messageGenerator.createVoiceChannel(n),e.next=3,this.sendMessageAsync(t,r);case 3:if(a=e.sent,a){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),this.deleteVoiceChannel=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=this.messageGenerator.deleteVoiceChannel(n),e.next=3,this.sendMessageAsync(t,r);case 3:if(a=e.sent,a){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),this.getContacts=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=this.messageGenerator.contactsRequest(),e.next=3,this.sendMessageAsync(t,n);case 3:if(r=e.sent,r){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",r.contacts);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.sendOffer=function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n,r,a){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=this.messageGenerator.offer(n,r,a),e.abrupt("return",this.sendMessageAsync(t,s));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),this.sendAnswer=function(e,t,n,r,a){var s=this.messageGenerator.answer(t,n,r,a);return this.sendMessage(e,s)},this.sendIce=function(e,t,n,r){var a=this.messageGenerator.ice(t,n,r);return this.sendMessage(e,a)}}var Te=Ie,Ue=function(e){Object(je["a"])(n,e);var t=Object(Oe["a"])(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Client Error",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return Object(J["a"])(this,n),e=t.call(this,r),e.shortMsg=r,e.responseStatus=a,e}return n}(Object(Re["a"])(Error)),Me={connecting:0,open:1,closing:2,closed:3},Ve={error:"error",message:"message",open:"open",close:"close"},$e=5e3,Ae=2e4,Ne=n("53ca"),De=n("ec26"),Pe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(De["a"])(),r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(J["a"])(this,e),this.payload=t,this.uuid=n,this.binarySent=r}return Object(Q["a"])(e,[{key:"toString",value:function(){return JSON.stringify({payload:this.payload,uuid:this.uuid,binarySent:this.binarySent})}},{key:"type",get:function(){return Object(Ne["a"])(this.payload)}}],[{key:"clone",value:function(t){return new e(t.payload,t.uuid,t.binarySent)}},{key:"fromString",value:function(t){var n=JSON.parse(t);return e.clone(n)}},{key:"fromEvent",value:function(t){return"string"===typeof t.data?e.fromString(t.data):new e(t.data)}}]),e}(),Le=Pe,He=function(e){Object(je["a"])(n,e);var t=Object(Oe["a"])(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Connection Error",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return Object(J["a"])(this,n),e=t.call(this,r),e.shortMsg=r,e.responseStatus=a,e}return n}(Object(Re["a"])(Error)),Be=function(e){Object(je["a"])(n,e);var t=Object(Oe["a"])(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Request timeout Error. Server is not responding!",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:401;return Object(J["a"])(this,n),t.call(this,e,r)}return n}(He),Fe=function(){function e(t){var n=t.url,r=t.connect,a=t.onOpenCallback,s=t.onMessageCallback,i=t.onCloseCallback,o=t.onErrorCallback;Object(J["a"])(this,e),this.url=n,this.socket=null,this.onOpenCallback=a,this.onMessageCallback=s,this.onCloseCallback=i,this.onErrorCallback=o,this.tasks=[],r&&this.connect()}return Object(Q["a"])(e,[{key:"send",value:function(e){if(this.status!==Me.open)throw new Error("connection is not opened!");var t=new Le(e,e.uniqueMessageId);this.socket.send(t)}},{key:"sendBinaryAsync",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var a=setTimeout((function(){r(new Be)}),Ae);n.addTask((function(t,n){if(n===Ve.error)return clearTimeout(a),setTimeout((function(){return e(null)}),0),!0;if(n===Ve.message){if("string"!==typeof t.data)return!1;var r=Le.fromEvent(t);return!!r.binarySent&&(clearTimeout(a),setTimeout((function(){return e(r.payload)}),0),!0)}return!1})),n.socket.send(t)})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"sendAsync",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(){var t,n,r=this,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=a.length>1&&void 0!==a[1]?a[1]:$e,e.abrupt("return",new Promise((function(e,a){var s=new Le(t,t.uniqueMessageId),i=setTimeout((function(){a(new Be)}),n);r.addTask((function(t,n){if(n===Ve.error)return clearTimeout(i),setTimeout((function(){return e(null)}),0),!0;if(n===Ve.message){if("string"!==typeof t.data)return!1;var r=Le.fromEvent(t);return s.uuid===r.uuid&&(clearTimeout(i),setTimeout((function(){if(r.payload.error)a(new _e);else{var t=Object(m["a"])({},r.payload);t.uniqueMessageId=r.uuid,e(t)}}),0),!0)}return!1})),r.socket.send(s)})));case 3:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"startTasks",value:function(e,t){if(this.tasks.length){var n=this.tasks.map((function(n){return{task:n,result:n(e,t)}}));this.tasks=n.filter((function(e){return!e.result})).map((function(e){return e.task}))}}},{key:"addTask",value:function(e){e&&this.tasks.push(e)}},{key:"onOpen",value:function(e){this.startTasks(e,Ve.open),this.onOpenCallback&&this.onOpenCallback(e)}},{key:"onMessage",value:function(e){this.startTasks(e,Ve.message);var t=Le.fromEvent(e),n=Object(m["a"])({},t.payload);n.uniqueMessageId=t.uuid,this.onMessageCallback&&this.onMessageCallback(n)}},{key:"onClose",value:function(e){this.startTasks(e,Ve.close),this.onCloseCallback&&this.onCloseCallback(e)}},{key:"onError",value:function(e){this.startTasks(e,Ve.error),this.onErrorCallback&&this.onErrorCallback(e)}},{key:"setSocketCallbacks",value:function(){if(!this.socket)throw new Error("AsyncSocket was not created! AsyncSocket Init error!");this.socket.onopen=this.onOpen.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onerror=this.onError.bind(this)}},{key:"connect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.url;if(!e)throw new Error("Bad url for websocket connection!");this.socket=new WebSocket(e),this.socket.binaryType="arraybuffer",this.setSocketCallbacks()}},{key:"connectAsync",value:function(e){var t=this;return new Promise((function(n){var r=setTimeout((function(){n(!1)}),$e);t.addTask((function(e,t){return t===Ve.error?(clearTimeout(r),setTimeout((function(){return n(!1)}),0),!0):t===Ve.open&&(clearTimeout(r),setTimeout((function(){return n(!0)}),0),!0)})),t.connect(e)}))}},{key:"disconnect",value:function(e,t){this.socket.close(e,t)}},{key:"disconnectAsync",value:function(e,t){var n=this;return new Promise((function(r){var a=setTimeout((function(){r(!0)}),$e);n.addTask((function(e,t){return(t===Ve.error||t===Ve.close)&&(clearTimeout(a),setTimeout((function(){return r(!0)}),0),!0)})),n.disconnect(e,t)}))}},{key:"status",get:function(){return this.socket?this.socket.readyState:null}}]),e}(),ze=Fe,qe=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;Object(J["a"])(this,e),this.virtualServerId=r,this.serverUrl=t,this.token=n,this.socket=null,this.onMessageCallback=a,this.onErrorCallback=s,this.errorsCount=0,this.errorsToReconnect=i,this.connectionStatuses=fe["CONNECTION_STATUSES"],this.connectionStatus=this.connectionStatuses.CLOSED,this.reconnectsAfterError=0}return Object(Q["a"])(e,[{key:"connectToServer",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(){var t,n,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]&&r[0],this.serverUrl){e.next=3;break}return e.abrupt("return",!1);case 3:return this.connectionStatus=this.connectionStatuses.OPENING,this.socket=new ze({url:this.serverUrl,onOpenCallback:this.onOpen.bind(this),onMessageCallback:this.onMessage.bind(this),onCloseCallback:this.onClose.bind(this),onErrorCallback:this.onError.bind(this)}),e.next=7,this.socket.connectAsync();case 7:if(n=e.sent,n||t){e.next=12;break}return e.next=11,this.connectToServer(!0);case 11:n=e.sent;case 12:if(!n){e.next=16;break}return e.next=15,this.sendToken();case 15:this.connectionStatus=this.connectionStatuses.OPENED;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"sendToken",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.socket.sendAsync({token:this.token,action:fe["ACTIONS"].userInfo}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"disconnect",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.connectionStatus=this.connectionStatuses.CLOSING,e.next=3,this.socket.disconnectAsync(t,n);case 3:return r=e.sent,r&&(this.connectionStatus=this.connectionStatuses.CLOSED),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"onMessage",value:function(e){this.onMessageCallback(this.virtualServerId,e)}},{key:"onError",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.errorsCount+=1,n=!1,e.prev=2,!(this.errorsCount>=this.errorsToReconnect||this.isClosed)){e.next=12;break}if(this.reconnectsAfterError){e.next=12;break}return this.reconnectsAfterError+=1,e.next=8,this.disconnect();case 8:return e.next=10,this.connectToServer();case 10:n=!e.sent,n||(this.errorsCount=0);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](2),this.onErrorCallback(this.virtualServerId,t);case 17:n&&this.onErrorCallback(this.virtualServerId,t);case 18:case"end":return e.stop()}}),e,this,[[2,14]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onOpen",value:function(){console.log("opened virtualServer ",this.virtualServerId)}},{key:"onClose",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.isClosed||this.isClosing,this.connectionStatus=this.connectionStatuses.CLOSED,!t){e.next=4;break}return e.abrupt("return");case 4:return n={error:{message:"connection suddenly closed!"}},e.next=7,this.onError(n);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"isClosed",get:function(){return this.connectionStatus===this.connectionStatuses.CLOSED}},{key:"isClosing",get:function(){return this.connectionStatus===this.connectionStatuses.CLOSING}},{key:"isOpening",get:function(){return this.connectionStatus===this.connectionStatuses.OPENING}},{key:"isOpened",get:function(){return this.connectionStatus===this.connectionStatuses.OPENED}}]),e}(),Ge=qe,Ye=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};Object(J["a"])(this,e),this.apiUrl=t,this.wsUrl="".concat(this.apiUrl.replace("http","ws"),"/wss"),this.user=void 0,this.servers={},this.token=void 0,this.onUpdateCallback=n,Te.call(this),this.voiceChannel=new ye(void 0,this.sendIce.bind(this),this.sendOffer.bind(this),this.sendAnswer.bind(this),r,a,this.onException.bind(this),s),this.connectToVoiceChannel=this.voiceChannel.connectToChannel.bind(this.voiceChannel),this.disconnectFromVoiceChannel=this.voiceChannel.disconnect.bind(this.voiceChannel),this.onContactDisconnect=this.voiceChannel.onContactDisconnect.bind(this.voiceChannel),this.switchMicrophone=this.voiceChannel.switchMicrophone.bind(this.voiceChannel)}return Object(Q["a"])(e,[{key:"login",value:function(){var t=Object(G["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.postToUrl("".concat(this.apiUrl,"/users/login"),{username:n,password:"sss"});case 2:return r=t.sent,t.abrupt("return",this.initializeAuth(r));case 4:case"end":return t.stop()}}),t,this)})));function n(e){return t.apply(this,arguments)}return n}()},{key:"register",value:function(){var t=Object(G["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.postToUrl("".concat(this.apiUrl,"/users/register"),{username:n,password:"sss"});case 2:return r=t.sent,t.abrupt("return",this.initializeAuth(r));case 4:case"end":return t.stop()}}),t,this)})));function n(e){return t.apply(this,arguments)}return n}()},{key:"initializeAuth",value:function(e){var t=this;if(!e)return null;if(!e.user)return null;this.user=Object(m["a"])({},e.user),this.token=e.token,this.initializeRequestInterface(this.token),this.voiceChannel.setUser(this.user),this.servers={},e.user.virtualServers.forEach((function(e){var n="".concat(t.wsUrl,"/").concat(e._id),r=e._id;t.servers[r]={url:n,id:r,client:new Ge(n,t.token,r,t.onMessage.bind(t),t.onError.bind(t))}}));var n=Object(ne["a"])(e.user.virtualServers),r=Object(m["a"])({},e.user);delete r.virtualServers;var a=e.token.slice();return{user:r,token:a,virtualServers:n}}},{key:"connect",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,t=Object.values(this.servers),t.length){e.next=4;break}return e.abrupt("return",!1);case 4:return e.next=6,Promise.all(t.map((function(e){return e.client.connectToServer()})));case 6:return n=e.sent,e.abrupt("return",!n.some((function(e){return!e})));case 10:return e.prev=10,e.t0=e["catch"](0),this.onException(e.t0),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,this,[[0,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"disconnect",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t=Object.values(this.servers),e.next=4,Promise.all(t.map((function(e){return e.client.disconnect()})));case 4:return n=e.sent,e.abrupt("return",!n.some((function(e){return!e})));case 8:return e.prev=8,e.t0=e["catch"](0),this.onException(e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"onMessage",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n.error){e.next=5;break}r=Object(m["a"])({},n),r.error.serverError=!0,e.next=15;break;case 5:if(!fe["VOICE_CHANNEL_SERVICE_ACTIONS"].includes(n.action)){e.next=15;break}if(!n.offer){e.next=11;break}return e.next=9,this.voiceChannel.onOffer(t,n);case 9:e.next=14;break;case 11:if(!n.ice){e.next=14;break}return e.next=14,this.voiceChannel.onIce(n);case 14:return e.abrupt("return");case 15:a={message:n,virtualServer:t},this.onUpdateCallback(a);case 17:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"onError",value:function(e,t){this.onUpdateCallback({virtualServer:e,message:{error:t}})}},{key:"sendMessage",value:function(e,t){var n=this.getClient(e);n||this.onException(new Error("There is not any connection to server!")),n.socket.send(t)}},{key:"sendMessageAsync",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=this.getClient(t),a){e.next=4;break}return this.onException(new Ue("There is not any connection to server!")),e.abrupt("return",r);case 4:return e.prev=4,e.next=7,a.socket.sendAsync(n);case 7:return e.abrupt("return",e.sent);case 10:return e.prev=10,e.t0=e["catch"](4),this.onException(e.t0),e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this,[[4,10]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"getClient",value:function(e){var t=Object.values(this.servers);if(t&&t.length){if(e)return this.servers[e].client;var n=Math.round(Math.random()*(t.length-1));return t[n].client}}},{key:"onException",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.error(e);var n=e instanceof Ue,r=e instanceof _e,a=e instanceof He;t&&(n=!0);var s={error:e,clientError:n,serverError:r,connectionError:a};this.onError(void 0,s)}},{key:"microphoneMuted",get:function(){return this.voiceChannel.microphoneMuted}},{key:"virtualServers",get:function(){return this.user&&this.user.virtualServers?this.user.virtualServers.map((function(e){return e._id})):[]}}],[{key:"postToUrl",value:function(){var e=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=JSON.stringify(n),a={headers:{"Content-Type":"application/json"},method:"post",body:r},e.prev=2,e.next=5,fetch(t,a);case 5:return s=e.sent,e.next=8,s.json();case 8:return e.abrupt("return",e.sent);case 11:return e.prev=11,e.t0=e["catch"](2),this.onException(e.t0),e.abrupt("return",void 0);case 15:case"end":return e.stop()}}),e,this,[[2,11]])})));function t(t,n){return e.apply(this,arguments)}return t}()}]),e}(),We=Ye,Je=function(){return{chatClient:void 0,voiceChannelOnline:!1,isChatDataInitialized:!1}},Qe={state:Je,mutations:{setChatDataInitialized:function(e,t){e.isChatDataInitialized=t},createChatEngine:function(e,t){var n=t.apiUrl,r=t.onUpdateCallback,a=t.onInputStreamCallback,s=t.onCloseConnectionCallback,i=t.onVoiceDetectionEventCallback;e.chatClient=new We(n,r,a,s,i)},setToDefaultsAll:function(e){var t=Je();Object.entries(t).forEach((function(t){var n=Object(re["a"])(t,2),r=n[0],a=n[1];e[r]=a}))},setVoiceChannelState:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.voiceChannelOnline=t}},getters:{chatEngine:function(e){return e.chatClient},microphoneMuted:function(e){return e.chatClient.microphoneMuted},isChatEngineInitialized:function(e){return!!e.chatClient}},actions:{switchMicrophone:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=e.state,a=e.getters,r.chatClient&&(s=void 0===t?!a.currentUserMutedStatus:t,r.chatClient.switchMicrophone(a.isSpeaker&&s));case 2:case"end":return n.stop()}}),n)})))()},sendUserStatus:function(e){return Object(G["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.state,r=e.getters,a=e.dispatch,t.next=3,a("switchMicrophone");case 3:n.chatClient.sendStatus(r.currentVirtualServerId,r.userStatus);case 4:case"end":return t.stop()}}),t)})))()},sendTextMessage:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.state,a=e.getters,n.next=3,r.chatClient.sendText(a.currentVirtualServerId,a.currentChatId,t);case 3:case"end":return n.stop()}}),n)})))()},initChatClient:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a,s,i,o,c,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.state,a=e.commit,s=t.apiUrl,i=t.onUpdateCallback,o=t.onInputStreamCallback,c=t.onCloseConnectionCallback,u=t.onVoiceDetectionEventCallback,!r.chatClient){n.next=4;break}return n.abrupt("return");case 4:a("createChatEngine",{apiUrl:s,onUpdateCallback:i,onInputStreamCallback:o,onCloseConnectionCallback:c,onVoiceDetectionEventCallback:u});case 5:case"end":return n.stop()}}),n)})))()},login:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a,s,i,o,c,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.state,a=e.commit,s=e.dispatch,i=t.user,o=t.password,c=t.noNotification,r.chatClient){n.next=4;break}return n.abrupt("return");case 4:return n.prev=4,n.next=7,r.chatClient.login(i,o);case 7:if(u=n.sent,u||c){n.next=11;break}return a("postNotification",{error:!0,message:"Wrong username or password!"}),n.abrupt("return");case 11:return n.next=13,s("saveUser",u);case 13:n.next=18;break;case 15:n.prev=15,n.t0=n["catch"](4),c||a("postNotification",{error:!0});case 18:case"end":return n.stop()}}),n,null,[[4,15]])})))()},connectToServer:function(e){return Object(G["a"])(regeneratorRuntime.mark((function t(){var n,r,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.state,r=e.getters,a=e.commit,r.isLoggedIn){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,n.chatClient.connect();case 6:s=t.sent,s||a("postNotification",{error:!0}),a("updateLinkStatus",s),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](3),a("postNotification",{error:!0});case 14:case"end":return t.stop()}}),t,null,[[3,11]])})))()},register:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a,s,i,o,c,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.state,a=e.commit,s=e.dispatch,i=t.user,o=t.password,c=t.noNotification,r.chatClient){n.next=4;break}return n.abrupt("return");case 4:return n.prev=4,n.next=7,r.chatClient.register(i,o);case 7:if(u=n.sent,u||c){n.next=11;break}return a("postNotification",{error:!0,message:"Wrong username or password!"}),n.abrupt("return");case 11:return n.next=13,s("saveUser",u);case 13:n.next=18;break;case 15:n.prev=15,n.t0=n["catch"](4),c||a("postNotification",{error:!0});case 18:case"end":return n.stop()}}),n,null,[[4,15]])})))()},logout:function(e){return Object(G["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.state,r=e.commit,t.next=3,n.chatClient.disconnect();case 3:a=t.sent,a&&r("setToDefaultsAll");case 5:case"end":return t.stop()}}),t)})))()},connectToVoiceChannel:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a,s,i,o,c,u,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.state,a=e.getters,s=e.commit,i=e.dispatch,!r.voiceChannelOnline){n.next=9;break}return o=a.currentVoiceChannelId,n.next=5,i("disconnectFromVoiceChannel");case 5:return n.next=7,i("updateUserVoiceChannelStatus",void 0);case 7:if(o!==t){n.next=9;break}return n.abrupt("return");case 9:return c=a.getVoiceChannelContacts(t).map((function(e){return e._id})),n.next=12,a.chatEngine.connectToVoiceChannel(a.currentVirtualServerId,t,c);case 12:return u=n.sent,l=u?t:void 0,n.next=16,i("updateUserVoiceChannelStatus",l);case 16:s("setVoiceChannelState",u);case 17:case"end":return n.stop()}}),n)})))()},disconnectFromVoiceChannel:function(e){return Object(G["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.state,r=e.commit,a=e.dispatch,t.next=3,n.chatClient.disconnectFromVoiceChannel();case 3:return t.next=5,a("setUserRoleToDefault");case 5:return t.next=7,a("updateUserVoiceChannelStatus",void 0);case 7:r("setVoiceChannelState",!1);case 8:case"end":return t.stop()}}),t)})))()},deleteVoiceChannelOnServer:function(e,t){return Object(G["a"])(regeneratorRuntime.mark((function n(){var r,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.state,a=e.getters,s=e.dispatch,a.currentVoiceChannelId!==t){n.next=4;break}return n.next=4,s("disconnectFromVoiceChannel");case 4:return n.next=6,r.chatClient.deleteVoiceChannel(a.currentVirtualServerId,t);case 6:case"end":return n.stop()}}),n)})))()},initializeAllChatUI:function(e){return Object(G["a"])(regeneratorRuntime.mark((function t(){var n,r,a,s,i,o,c,u,l,h;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.commit,r=e.state,a=e.dispatch,s=e.rootState,!r.isChatDataInitialized){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,r.chatClient.getContacts();case 5:return i=t.sent,i&&n("updateContacts",i),t.next=9,r.chatClient.getAllChats();case 9:if(o=t.sent,!o){t.next=17;break}return n("updateChats",o),c=Object.values(o).flat(),t.next=15,r.chatClient.getAllHistory(c);case 15:u=t.sent,u&&n("updateChatHistory",u);case 17:return t.next=19,r.chatClient.getAllVoiceChannels();case 19:if(l=t.sent,l&&n("updateVoiceChannels",l),h=s.chatData.virtualServers,!Object.values(h).length){t.next=25;break}return t.next=25,a("setCurrentVirtualServer",Object.keys(h)[0]);case 25:return t.next=27,a("sendUserStatus");case 27:return t.next=29,a("switchMicrophone");case 29:n("setChatDataInitialized",!0);case 30:case"end":return t.stop()}}),t)})))()},disconnectContact:function(e,t){var n=e.state;n.chatClient.onContactDisconnect(t)},getHistoryChunk:function(e){return Object(G["a"])(regeneratorRuntime.mark((function t(){var n,r,a,s,i,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.commit,r=e.state,a=e.getters,s=a.currentChatId,i=a.currentVirtualServerId,o=a.currentHistorySize,t.prev=4,t.next=7,r.chatClient.getHistory(i,s,o);case 7:c=t.sent,c&&c.length||n("setHistoryLoaded",s),c&&n("addChatHistoryChunk",c),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](4),console.debug("history chunk error ",t.t0);case 15:case"end":return t.stop()}}),t,null,[[4,12]])})))()}}};r["default"].use(A["a"]);var Ke=function(){return{}},Xe=new A["a"].Store({state:Ke(),actions:{afterMessageSending:function(e){return Object(G["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.commit,r=e.dispatch,n("setAttachedFiles",[]),n("saveRecord",void 0),t.next=5,r("updateUserChatStatus",void 0);case 5:case"end":return t.stop()}}),t)})))()}},modules:{audio:te,ui:ue,chatEngine:Qe,chatData:ve}});function Ze(e){return et.apply(this,arguments)}function et(){return et=Object(G["a"])(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.message,r=t.virtualServer,!n.error){e.next=5;break}return a={error:n.error,serverError:!!n.serverError,message:void 0,title:void 0},Xe.commit("postNotification",a),e.abrupt("return");case 5:if(n.contactsOnline&&Xe.commit("updateContactsOnline",{virtualServer:r,contactsOnline:n.contactsOnline}),n.voiceChannel&&Xe.commit("addVoiceChannel",{virtualServer:r,voiceChannel:n.voiceChannel}),n.chat&&Xe.commit("addChat",{virtualServer:r,chat:n.chat}),!n.voiceChannelId){e.next=11;break}return e.next=11,Xe.dispatch("deleteVoiceChannel",{virtualServer:r,voiceChannelId:n.voiceChannelId});case 11:if(!(n.text||n.files||n.audio)||!n.date){e.next=14;break}return e.next=14,Xe.dispatch("addMessage",n);case 14:if(!n.status){e.next=17;break}return e.next=17,Xe.dispatch("updateStatus",{virtualServer:r,status:n.status});case 17:case"end":return e.stop()}}),e)}))),et.apply(this,arguments)}function tt(e,t){return nt.apply(this,arguments)}function nt(){return nt=Object(G["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n?Xe.commit("setContactStream",{contact:t,stream:n}):Xe.commit("deleteContactStream",t);case 1:case"end":return e.stop()}}),e)}))),nt.apply(this,arguments)}function rt(e){return at.apply(this,arguments)}function at(){return at=Object(G["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:Xe.commit("deleteContactStream",t);case 1:case"end":return e.stop()}}),e)}))),at.apply(this,arguments)}function st(e){return it.apply(this,arguments)}function it(){return it=Object(G["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=t.contact,r=t.value,Xe.commit("setContactVoiceState",{contact:n,value:r});case 2:case"end":return e.stop()}}),e)}))),it.apply(this,arguments)}var ot={name:"LoginForm",components:{},data:function(){return{form:{username:"",password:""},show:!0}},computed:{isOnline:function(){return this.$store.getters.isSystemOnline}},methods:{onSubmit:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.preventDefault(),n.next=3,t.signIn();case 3:if(!t.isOnline){n.next=6;break}return n.next=6,t.$router.push({name:ie});case 6:case"end":return n.stop()}}),n)})))()},onReset:function(e){var t=this;e.preventDefault(),this.form.username="",this.form.password="",this.show=!1,this.$nextTick((function(){t.show=!0}))},signIn:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("initChatClient",{apiUrl:Y,onUpdateCallback:Ze,onInputStreamCallback:tt,onCloseConnectionCallback:rt,onVoiceDetectionEventCallback:st});case 2:return t.next=4,e.$store.dispatch("login",{user:e.form.username,password:e.form.password});case 4:return t.next=6,e.$store.dispatch("connectToServer");case 6:return t.next=8,e.$store.dispatch("initializeAllChatUI");case 8:case"end":return t.stop()}}),t)})))()}}},ct=ot,ut=(n("28c3"),Object(w["a"])(ct,z,q,!1,null,"405844cb",null)),lt=ut.exports,ht=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("header",{staticClass:"d-flex justify-content-center align-items-center"},[e._m(0),n("div",{staticClass:"main-title"},[e._v(e._s(e.mainTitle))])])},ft=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"logo me-3"},[n("img",{attrs:{src:"/img/logo.png",alt:"logo"}})])}],pt={name:"MainHeader",data:function(){return{}},computed:Object(m["a"])({},Object(A["b"])(["mainTitle"]))},dt=pt,mt=(n("01da"),Object(w["a"])(dt,ht,ft,!1,null,"2110e834",null)),vt=mt.exports,bt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("footer",[n("app-main-footer-links")],1)},gt=[],Ct=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},kt=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"d-flex justify-content-around footer-links"},[n("a",{attrs:{href:"#"}},[e._v("Investors")]),n("a",{attrs:{href:"#"}},[e._v("Discord")]),n("a",{attrs:{href:"#"}},[e._v("Report a Bug")])])}],wt={name:"MainFooterLinks",data:function(){return{}}},St=wt,yt=(n("9972"),Object(w["a"])(St,Ct,kt,!1,null,"76793501",null)),xt=yt.exports,jt={name:"MainFooter",components:{appMainFooterLinks:xt},data:function(){return{}}},Ot=jt,Rt=Object(w["a"])(Ot,bt,gt,!1,null,null,null),_t=Rt.exports,Et={name:"signIn",components:{appMainHeader:vt,appLoginForm:lt,appMainFooter:_t}},It=Et,Tt=Object(w["a"])(It,B,F,!1,null,null,null),Ut=Tt.exports,Mt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page sign-up flex-grow-1"},[n("app-main-header"),n("div",{},[n("div",{staticClass:"w-100 h-100 d-flex justify-content-center align-items-center"},[n("app-register-form")],1)]),n("app-main-footer")],1)},Vt=[],$t=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.show?n("b-form",{staticClass:"h-100 w-100 d-flex flex-column justify-content-center align-items-stretch",on:{submit:e.onSubmit,reset:e.onReset}},[n("b-form-group",{attrs:{id:"input-group-2",label:"Your Name:","label-for":"input-2"}},[n("b-form-input",{attrs:{id:"input-2",placeholder:"Enter name",required:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),n("div",{staticClass:"my-1 buttons d-flex"},[n("b-button",{staticClass:"col-5",attrs:{type:"reset",variant:"danger"}},[e._v("Reset")]),n("b-button",{staticClass:"offset-2 col-5",attrs:{type:"submit",variant:"primary"}},[e._v("Sign Up")])],1)],1):e._e()},At=[],Nt={name:"RegisterForm",components:{},data:function(){return{form:{username:"",password:""},show:!0}},computed:{isOnline:function(){return this.$store.getters.isSystemOnline}},methods:{onSubmit:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.preventDefault(),n.next=3,t.signUp();case 3:case"end":return n.stop()}}),n)})))()},onReset:function(e){var t=this;e.preventDefault(),this.form.username="",this.form.password="",this.show=!1,this.$nextTick((function(){t.show=!0}))},signUp:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("initChatClient",{apiUrl:Y,onUpdateCallback:Ze,onInputStreamCallback:tt,onCloseConnectionCallback:rt,onVoiceDetectionEventCallback:st});case 2:return t.next=4,e.$store.dispatch("register",{user:e.form.username,password:e.form.password});case 4:return t.next=6,e.$store.dispatch("connectToServer");case 6:if(!e.isOnline){t.next=11;break}return t.next=9,e.$router.push({name:ie});case 9:return t.next=11,e.$store.dispatch("initializeAllChatUI");case 11:case"end":return t.stop()}}),t)})))()}}},Dt=Nt,Pt=(n("3dcd"),Object(w["a"])(Dt,$t,At,!1,null,"16252b93",null)),Lt=Pt.exports,Ht={name:"signUp",components:{appMainHeader:vt,appRegisterForm:Lt,appMainFooter:_t}},Bt=Ht,Ft=Object(w["a"])(Bt,Mt,Vt,!1,null,null,null),zt=Ft.exports,qt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page free-users"},[n("app-main-header"),n("app-free-users-buttons"),n("app-free-users-list"),n("app-main-footer")],1)},Gt=[],Yt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"d-flex justify-content-between align-items-center"},[n("div",{staticClass:"m-2"},[n("app-home-button")],1),n("button",{staticClass:"header-text-button"},[e._v(" Free online users: ")]),n("div",{staticClass:"m-2"},[n("app-user-button")],1)])},Wt=[],Jt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"avatar-button",on:{click:e.onClick}},[n("img",{staticClass:"avatar",attrs:{src:"https://icons.iconarchive.com/icons/graphicloads/100-flat/256/home-icon.png",alt:"avatar"}})])},Qt=[],Kt={name:"HomeButton",data:function(){return{}},methods:{onClick:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$router.push({name:"home"});case 2:case"end":return t.stop()}}),t)})))()}}},Xt=Kt,Zt=(n("6aa3"),Object(w["a"])(Xt,Jt,Qt,!1,null,"980b2f70",null)),en=Zt.exports,tn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"avatar-button",on:{click:e.onClick}},[n("img",{staticClass:"avatar",attrs:{src:"https://avatars.githubusercontent.com/u/33094186?v=4",alt:"avatar"}})])},nn=[],rn={name:"FreeUsersButton",data:function(){return{}},methods:{onClick:function(){return Object(G["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("user button what ???");case 1:case"end":return e.stop()}}),e)})))()}}},an=rn,sn=Object(w["a"])(an,tn,nn,!1,null,null,null),on=sn.exports,cn={name:"FreeUsersButtons",components:{appHomeButton:en,appUserButton:on}},un=cn,ln=Object(w["a"])(un,Yt,Wt,!1,null,null,null),hn=ln.exports,fn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",[n("div",{staticClass:"d-flex align-items-center flex-wrap"},e._l(e.freeUsers,(function(e){return n("app-user-avatar",{key:e._id,attrs:{user:e}})})),1)])},pn=[],dn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user-avatar m-2"},[n("button",{staticClass:"avatar-button",on:{click:e.onClick}},[n("img",{staticClass:"avatar",attrs:{src:"https://avatars.githubusercontent.com/u/51411388?v=4",alt:"avatar"}}),n("div",{staticClass:"user-name mt-2"},[e._v(e._s(e.name))]),e.isRoomOpened&&e.muted?n("div",{staticClass:"user-mute p-1"},[n("img",{attrs:{src:"/img/mute.svg",width:"16",height:"16"}})]):e._e()])])},mn=[],vn=(n("a15b"),n("1276"),{name:"UserAvatar",props:{user:Object},data:function(){return{}},computed:Object(m["a"])(Object(m["a"])({},Object(A["b"])({getMutedByUserId:"getMutedByUserId",isRoomOpened:"isRoomOpened",currentUser:"user",isSpeaker:"isSpeaker",currentUserMutedStatus:"currentUserMutedStatus"})),{},{isCurrentUser:function(){return this.currentUser._id===this.user._id},muted:function(){return this.isCurrentUser?this.currentUserMutedStatus:this.getMutedByUserId(this.user._id)},name:function(){return this.user.username},initials:function(){var e=this.name;return e?"string"!==typeof e?"":e.split(" ").map((function(e){return e.toUpperCase()[0]})).splice(0,2).join(""):""}}),methods:{onClick:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isCurrentUser){t.next=3;break}return t.next=3,e.$store.dispatch("updateUserMutedStatus",!e.currentUserMutedStatus);case 3:case"end":return t.stop()}}),t)})))()}}}),bn=vn,gn=(n("69d4"),Object(w["a"])(bn,dn,mn,!1,null,"8c67bb5e",null)),Cn=gn.exports,kn={name:"FreeUsersList",components:{appUserAvatar:Cn},computed:Object(m["a"])({},Object(A["b"])(["freeUsers"]))},wn=kn,Sn=Object(w["a"])(wn,fn,pn,!1,null,null,null),yn=Sn.exports,xn={name:"FreeUsers",components:{appMainHeader:vt,appFreeUsersButtons:hn,appFreeUsersList:yn,appMainFooter:_t}},jn=xn,On=Object(w["a"])(jn,qt,Gt,!1,null,"6aa89137",null),Rn=On.exports,_n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page sign-in flex-grow-1"},[n("app-main-header"),n("div",{},[n("div",{staticClass:"w-100 h-100 d-flex justify-content-center align-items-center"},[n("app-entry-form")],1)]),n("app-main-footer")],1)},En=[],In=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.show?n("b-form",{staticClass:"h-100 w-100 d-flex flex-column justify-content-center align-items-stretch",on:{submit:e.onSubmit,reset:e.onReset}},[n("b-form-group",{attrs:{id:"input-group-2",label:"Your Name:","label-for":"input-2"}},[n("b-form-input",{attrs:{id:"input-2",placeholder:"Enter your name",required:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)],1):e._e()},Tn=[],Un={name:"EntryForm",components:{},data:function(){return{form:{username:"",password:""},show:!0}},computed:Object(m["a"])({},Object(A["b"])(["isLoggedIn","isSystemOnline","previousRoute"])),methods:{onSubmit:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.preventDefault(),n.next=3,t.entry();case 3:if(!t.isSystemOnline){n.next=7;break}return r=t.previousRoute&&"room"===t.previousRoute.name?t.previousRoute:{name:ie},n.next=7,t.$router.push(r);case 7:case"end":return n.stop()}}),n)})))()},onReset:function(e){var t=this;e.preventDefault(),this.form.username="",this.form.password="",this.show=!1,this.$nextTick((function(){t.show=!0}))},entry:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("initChatClient",{apiUrl:Y,onUpdateCallback:Ze,onInputStreamCallback:tt,onCloseConnectionCallback:rt,onVoiceDetectionEventCallback:st});case 2:return n={user:e.form.username,password:e.form.password,noNotification:!0},t.next=5,e.$store.dispatch("login",n);case 5:if(e.isLoggedIn){t.next=8;break}return t.next=8,e.$store.dispatch("register",n);case 8:if(!e.isLoggedIn){t.next=13;break}return t.next=11,e.$store.dispatch("connectToServer");case 11:return t.next=13,e.$store.dispatch("initializeAllChatUI");case 13:case"end":return t.stop()}}),t)})))()}}},Mn=Un,Vn=(n("c282"),Object(w["a"])(Mn,In,Tn,!1,null,"52137e32",null)),$n=Vn.exports,An={name:"Entry",components:{appMainHeader:vt,appEntryForm:$n,appMainFooter:_t}},Nn=An,Dn=Object(w["a"])(Nn,_n,En,!1,null,null,null),Pn=Dn.exports;function Ln(e){Xe.commit("pushRoute",e)}function Hn(e,t,n){Xe.getters.currentRoute||Xe.commit("pushRoute",e),e.matched.some((function(e){return e.meta.requiresAuth}))&&!Xe.getters.isLoggedIn?n({name:se}):oe.includes(e.name)&&Xe.getters.isLoggedIn?n({name:ie}):n()}var Bn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page home flex-grow-1"},[n("app-main-header"),n("app-rooms-buttons"),n("app-room-card-list"),n("app-rooms-footer"),n("transition",{attrs:{appear:"",name:"fade"}},[n("router-view")],1)],1)},Fn=[],zn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"d-flex justify-content-center align-items-center flex-wrap"},[n("div",{staticClass:"m-2"},[n("app-free-users-button")],1),n("div",{staticClass:"m-2"},[n("app-user-button")],1)])},qn=[],Gn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"avatar-button",on:{click:e.onClick}},[n("img",{staticClass:"avatar",attrs:{src:"https://simg.nicepng.com/png/small/128-1280406_view-user-icon-png-user-circle-icon-png.png",alt:"avatar"}})])},Yn=[],Wn={name:"FreeUsersButton",data:function(){return{}},methods:{onClick:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$router.push({name:"freeUsers"});case 2:case"end":return t.stop()}}),t)})))()}}},Jn=Wn,Qn=(n("92ff"),Object(w["a"])(Jn,Gn,Yn,!1,null,"2dcc6a96",null)),Kn=Qn.exports,Xn={name:"RoomsButtons",components:{appFreeUsersButton:Kn,appUserButton:on},data:function(){return{}}},Zn=Xn,er=Object(w["a"])(Zn,zn,qn,!1,null,null,null),tr=er.exports,nr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"row room-card-section"},e._l(e.voiceChannels,(function(e){return n("app-room-card",{key:e._id,attrs:{"voice-channel":e}})})),1)},rr=[],ar=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"col-12"},[n("button",{staticClass:"room-card",on:{click:e.onClick}},[n("div",{staticClass:"d-flex"},[n("div",{staticClass:"room-card-title"},[e._v(e._s(e.voiceChannel.name))]),n("div",[n("img",{staticStyle:{filter:"invert(1)"},attrs:{src:"/img/user.svg",width:"24",height:"24",alt:"users"}}),e._v(" "+e._s(e.voiceChannelContacts.length)+" ")])]),n("div",{staticClass:"d-flex justify-content-between w-100"},[n("app-user-list",{attrs:{users:e.voiceChannelContacts.slice(0,5)}}),n("app-close-room-button",{attrs:{voiceChannel:e.voiceChannel}})],1)])])},sr=[],ir=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user-list"},e._l(e.users,(function(e){return n("app-user-name",{key:e._id,attrs:{user:e}})})),1)},or=[],cr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sub-text"},[e._v(e._s(e.user.username))])},ur=[],lr={name:"UserName",props:{user:Object},data:function(){return{}}},hr=lr,fr=(n("09ec"),Object(w["a"])(hr,cr,ur,!1,null,"7974d72a",null)),pr=fr.exports,dr={name:"UserList",props:{users:Array},data:function(){return{}},components:{appUserName:pr}},mr=dr,vr=Object(w["a"])(mr,ir,or,!1,null,null,null),br=vr.exports,gr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"close-room-button",attrs:{type:"button"},on:{click:e.onClick}},[n("b-icon",{staticClass:"text-danger",attrs:{icon:"x"}})],1)},Cr=[],kr={name:"CloseRoomButton",props:{voiceChannel:Object},data:function(){return{}},methods:{onClick:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.stopImmediatePropagation(),n.next=3,t.$router.push({name:"closeRoom",params:{roomId:t.voiceChannel._id}});case 3:case"end":return n.stop()}}),n)})))()}}},wr=kr,Sr=(n("64dd"),Object(w["a"])(wr,gr,Cr,!1,null,"e1e1adb8",null)),yr=Sr.exports,xr={name:"RoomCard",props:{voiceChannel:Object},data:function(){return{}},components:{appUserList:br,appCloseRoomButton:yr},computed:Object(m["a"])(Object(m["a"])({},Object(A["b"])({currentVoiceChannelId:"currentVoiceChannelId"})),{},{voiceChannelContacts:function(){return this.$store.getters.getVoiceChannelContacts(this.voiceChannel._id)},isListening:function(){return this.voiceChannel._id===this.currentVoiceChannelId}}),methods:{onClick:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isListening){t.next=3;break}return t.next=3,e.$store.dispatch("connectToVoiceChannel",e.voiceChannel._id);case 3:return t.next=5,e.$router.push({name:"room",params:{roomId:e.voiceChannel._id}});case 5:case"end":return t.stop()}}),t)})))()}}},jr=xr,Or=(n("9b33"),Object(w["a"])(jr,ar,sr,!1,null,"5b4b6718",null)),Rr=Or.exports,_r={name:"RoomCardList",components:{appRoomCard:Rr},data:function(){return{}},computed:{voiceChannels:function(){return this.$store.getters.voiceChannelsByCurrentVirtualServer}}},Er=_r,Ir=Object(w["a"])(Er,nr,rr,!1,null,null,null),Tr=Ir.exports,Ur=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("footer",[n("div",{staticClass:"d-grid gap-2 footer-button"},[n("app-create-room-button")],1),n("app-main-footer-links")],1)},Mr=[],Vr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"btn btn-primary w-100",attrs:{type:"button"},on:{click:e.onClick}},[e._v("Create Room")])},$r=[],Ar={name:"CreateRoomButton",data:function(){return{}},methods:{onClick:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$router.push({name:"createRoom"});case 2:case"end":return t.stop()}}),t)})))()}}},Nr=Ar,Dr=Object(w["a"])(Nr,Vr,$r,!1,null,null,null),Pr=Dr.exports,Lr={name:"RoomFooter",components:{appCreateRoomButton:Pr,appMainFooterLinks:xt},data:function(){return{}}},Hr=Lr,Br=Object(w["a"])(Hr,Ur,Mr,!1,null,null,null),Fr=Br.exports,zr={name:"Rooms",components:{appMainHeader:vt,appRoomsButtons:tr,appRoomCardList:Tr,appRoomsFooter:Fr},data:function(){return{}}},qr=zr,Gr=Object(w["a"])(qr,Bn,Fn,!1,null,null,null),Yr=Gr.exports,Wr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("app-sub-page-modal",[n("app-new-room-form")],1)},Jr=[],Qr=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.show?n("b-form",{staticClass:"w-100 d-flex flex-column justify-content-center align-items-stretch",on:{submit:e.onSubmit}},[n("b-form-group",{attrs:{id:"input-group-2",label:"New room name:","label-for":"input-2"}},[n("b-form-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{id:"input-2",placeholder:"Enter title",required:""},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.onEsc(t)}},model:{value:e.roomTitle,callback:function(t){e.roomTitle=t},expression:"roomTitle"}})],1)],1):e._e()},Kr=[],Xr={name:"NewRoomForm",components:{},data:function(){return{roomTitle:"",show:!0}},computed:Object(m["a"])({},Object(A["b"])({isOnline:"isSystemOnline",chatClient:"chatEngine",virtualServer:"currentVirtualServerId"})),methods:{onSubmit:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.preventDefault(),n.next=3,t.createRoom();case 3:if(!t.isOnline){n.next=6;break}return n.next=6,t.$router.push({name:"home"});case 6:case"end":return n.stop()}}),n)})))()},createRoom:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isOnline){t.next=3;break}return t.next=3,e.chatClient.createVoiceChannel(e.virtualServer,e.roomTitle);case 3:case"end":return t.stop()}}),t)})))()},onEsc:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$router.push(e.$store.getters.previousRoute);case 2:case"end":return t.stop()}}),t)})))()}}},Zr=Xr,ea=(n("9ecb"),Object(w["a"])(Zr,Qr,Kr,!1,null,"9aff7fc6",null)),ta=ea.exports,na=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sub-page-modal create-room"},[n("div",{staticClass:"modal-form"},[n("div",{staticClass:"d-flex justify-content-end"},[n("app-close-form-button")],1),e._t("default")],2)])},ra=[],aa=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"close-form-button",attrs:{type:"button"},on:{click:e.onClick}},[n("b-icon",{staticClass:"text-light",attrs:{icon:"x"}})],1)},sa=[],ia={name:"CloseFormButton",data:function(){return{}},methods:{onClick:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.stopPropagation(),!(t.$route.matched.length>1)){n.next=6;break}return n.next=4,t.$router.push(t.$route.matched[t.$route.matched.length-2]);case 4:n.next=8;break;case 6:return n.next=8,t.$router.push(t.$store.getters.previousRoute);case 8:case"end":return n.stop()}}),n)})))()}}},oa=ia,ca=(n("e415"),Object(w["a"])(oa,aa,sa,!1,null,"31d5b005",null)),ua=ca.exports,la={name:"SubPageModal",components:{appCloseFormButton:ua}},ha=la,fa=Object(w["a"])(ha,na,ra,!1,null,"2249ea64",null),pa=fa.exports,da={name:"CreateRoom",components:{appSubPageModal:pa,appNewRoomForm:ta}},ma=da,va=Object(w["a"])(ma,Wr,Jr,!1,null,"49effaac",null),ba=va.exports,ga=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page room flex-grow-1\n    d-flex flex-column flex-nowrap align-items-stretch justify-content-center"},[n("app-room-header",{attrs:{roomTitle:e.roomTitle}}),n("div",{staticClass:"flex-grow-1"},[n("app-room-speakers"),n("app-room-listeners"),n("router-view")],1),n("app-room-footer")],1)},Ca=[],ka=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("header",{staticClass:"d-flex justify-content-between align-items-center"},[n("app-home-button"),n("button",{staticClass:"header-text-button"},[e._v(" "+e._s(e.roomTitle)+" ")]),n("app-user-button")],1)},wa=[],Sa={name:"RoomHeader",props:{roomTitle:{type:String,default:""}},components:{appHomeButton:en,appUserButton:on}},ya=Sa,xa=(n("7318"),Object(w["a"])(ya,ka,wa,!1,null,"2b1c65c5",null)),ja=xa.exports,Oa=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",[n("div",{staticClass:"group-title"},[e._v("Speakers ("+e._s(e.speakers.length)+")")]),n("div",{staticClass:"d-flex align-items-start flex-wrap"},[e._l(e.speakers,(function(t){return n("app-user-avatar",{key:t._id,class:e.getContactVoiceState(t._id)?"active":"",attrs:{user:t}})})),n("app-speak-button")],2)])},Ra=[],_a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"m-2"},[n("button",{staticClass:"avatar-button",on:{click:e.onClick}},[n("img",{staticClass:"avatar",attrs:{src:e.imgSource,alt:"avatar"}})])])},Ea=[],Ia={name:"SpeakButton",data:function(){return{}},computed:Object(m["a"])(Object(m["a"])({},Object(A["b"])(["isSpeaker"])),{},{imgSource:function(){return this.isSpeaker?"/img/minus.png":"/img/plus.png"}}),methods:{onClick:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.isSpeaker?fe["VOICE_CHANNEL_USER_ROLES"].listener:fe["VOICE_CHANNEL_USER_ROLES"].speaker,t.next=3,e.$store.dispatch("updateUserRole",n);case 3:case"end":return t.stop()}}),t)})))()}}},Ta=Ia,Ua=(n("7445"),Object(w["a"])(Ta,_a,Ea,!1,null,"30851123",null)),Ma=Ua.exports,Va={name:"RoomSpeakers",components:{appUserAvatar:Cn,appSpeakButton:Ma},computed:Object(m["a"])({},Object(A["b"])(["speakers","activeStreams","getContactVoiceState"]))},$a=Va,Aa=(n("7e57"),Object(w["a"])($a,Oa,Ra,!1,null,"ef9476b8",null)),Na=Aa.exports,Da=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",[n("div",{staticClass:"group-title"},[e._v("Listeners ("+e._s(e.listeners.length)+")")]),n("div",{staticClass:"d-flex align-items-center flex-wrap"},e._l(e.listeners,(function(e){return n("app-user-avatar",{key:e._id,attrs:{user:e}})})),1)])},Pa=[],La={name:"RoomListeners",components:{appUserAvatar:Cn},computed:Object(m["a"])({},Object(A["b"])(["listeners"]))},Ha=La,Ba=(n("4853"),Object(w["a"])(Ha,Da,Pa,!1,null,"41920cd5",null)),Fa=Ba.exports,za=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("footer",[n("div",{staticClass:"d-flex justify-content-around footer-links"},[n("app-leave-room-button"),n("app-chat-button"),n("app-invite-to-room-button")],1)])},qa=[],Ga=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{attrs:{title:"Leave current room"},on:{click:e.onClick}},[n("img",{attrs:{src:"/img/leave.svg",width:"24",height:"24"}}),n("div",[e._v("Leave")])])},Ya=[],Wa={name:"LeaveRoomButton",data:function(){return{}},methods:{onClick:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("disconnectFromVoiceChannel");case 2:return t.next=4,e.$router.push({name:"home"});case 4:case"end":return t.stop()}}),t)})))()}}},Ja=Wa,Qa=Object(w["a"])(Ja,Ga,Ya,!1,null,null,null),Ka=Qa.exports,Xa=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{on:{click:e.onClick}},[e._m(0),n("div",[e._v("Chat")])])},Za=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"d-flex justify-content-center"},[n("div",{staticStyle:{position:"relative"}},[n("img",{attrs:{src:"/img/chat.svg",width:"24",height:"24"}}),n("span",{staticClass:"new-message"})])])}],es={name:"ChatButton",data:function(){return{}},methods:{onClick:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("chat"===e.$route.name){t.next=5;break}return t.next=3,e.$router.push({name:"chat"});case 3:t.next=7;break;case 5:return t.next=7,e.$router.push({name:"room"});case 7:case"end":return t.stop()}}),t)})))()}}},ts=es,ns=Object(w["a"])(ts,Xa,Za,!1,null,null,null),rs=ns.exports,as=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{attrs:{title:"Invite users to room"},on:{click:e.onClick}},[n("img",{attrs:{src:"/img/invite.svg",width:"24",height:"24"}}),n("div",[e._v("Invite")])])},ss=[],is={name:"InviteToRoomButton",data:function(){return{}},methods:{onClick:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,navigator.clipboard.writeText(window.location.href);case 2:e.$store.commit("postNotification",{title:"Attention!",message:"Invitation Link saved in Buffer!"});case 3:case"end":return t.stop()}}),t)})))()}}},os=is,cs=(n("6f47"),Object(w["a"])(os,as,ss,!1,null,"3cb61d93",null)),us=cs.exports,ls={name:"RoomFooter",components:{appLeaveRoomButton:Ka,appChatButton:rs,appInviteToRoomButton:us}},hs=ls,fs=(n("40fe"),Object(w["a"])(hs,za,qa,!1,null,"2fba8305",null)),ps=fs.exports,ds={name:"Room",components:{appRoomHeader:ja,appRoomSpeakers:Na,appRoomListeners:Fa,appRoomFooter:ps},computed:Object(m["a"])(Object(m["a"])({},Object(A["b"])(["currentVoiceChannel","currentVoiceChannelId","voiceChannelById"])),{},{withChat:function(){return"chat"===this.$route.name},roomTitle:function(){return this.currentVoiceChannel?this.currentVoiceChannel.name:""}}),beforeMount:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.voiceChannelById(e.$route.params.roomId),n){t.next=5;break}return t.next=4,e.$router.push({name:ie});case 4:return t.abrupt("return");case 5:if(n._id===e.currentVoiceChannelId){t.next=10;break}return t.next=8,e.$store.dispatch("connectToVoiceChannel",n._id);case 8:return t.next=10,e.$store.dispatch("setCurrentChat",n.chat);case 10:case"end":return t.stop()}}),t)})))()}},ms=ds,vs=Object(w["a"])(ms,ga,Ca,!1,null,"5dcf2800",null),bs=vs.exports,gs=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"mt-4"},[n("div",{staticClass:"group-title"},[e._v("Chat")]),n("div",{staticClass:"chat-wrapper d-flex flex-column align-items-stretch flex-nowrap"},[n("app-history",{staticClass:"flex-grow-1 mt-1"}),n("app-new-message",{staticClass:"mx-1"}),n("app-status",{staticClass:"my-1"})],1)])},Cs=[],ks=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"chat-history"}},[n("div",{ref:"chatHistory",staticClass:"chat-history__wrapper h-100 w-100 p-3 d-flex flex-column align-items-start",attrs:{scrolltop:e.scrollTop},on:{scroll:e.onScroll,wheel:e.onUserInput,keydown:e.onUserInput,mousedown:e.onUserInput}},e._l(e.chatHistory,(function(e){return n("app-message",{key:e._id,attrs:{message:e}})})),1)])},ws=[],Ss=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user-message text-left",class:e.isUserMessage?"pl-4":""},[e._m(0),n("button",{staticClass:"user-name-link"},[e._v(" ~"+e._s(e.username)+" ")]),n("span",{staticClass:"mr-1"},[e._v(" : ")]),n("span",{staticClass:"flex-1 m-0 text-bright"},[e._v(" "+e._s(e.message.text)+" ")])])},ys=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"user-avatar-wrapper"},[n("img",{staticStyle:{width:"20px",height:"20px","border-radius":"30%",display:"inline"},attrs:{alt:"avatar",src:"https://avatars.githubusercontent.com/u/2845244?v=4"}})])}],xs={name:"Message",props:{message:String},computed:{isUserMessage:function(){return this.message.user===this.$store.state.chatData.user._id},username:function(){if(!this.message)return"";var e=this.$store.getters.usernameById(this.message.user);return e||""}}},js=xs,Os=(n("5f99"),Object(w["a"])(js,Ss,ys,!1,null,"0d4ac61c",null)),Rs=Os.exports,_s={name:"ChatHistory",components:{appMessage:Rs},data:function(){return{scrollTop:this.historyHeight,userScrolling:!1,userScrollingTimeout:void 0,fullHistoryLoaded:!1,previousHistorySize:null,previousStartMessageId:void 0,autoScroll:!1}},computed:Object(m["a"])(Object(m["a"])({},Object(A["b"])({currentChat:"currentChatId",chatHistory:"currentChatHistory",isHistoryFull:"isHistoryFull"})),{},{historyHeight:function(){return this.historyElement.scrollHeight+1e4},historySize:function(){return this.chatHistory.length},historyElement:function(){return this.$refs.chatHistory}}),methods:{isScrolledToEnd:function(){var e=this.historyElement.scrollHeight-this.historyElement.scrollTop;return e<=this.historyElement.clientHeight},scrollHistoryToEnd:function(){this.userScrolling||this.historyElement&&this.historyElement.children.length&&(this.historyElement.children[this.historySize-1].scrollIntoView(),this.autoScroll=!0)},scrollToPreviousStart:function(){this.historyElement&&this.historyElement.children.length&&null!==this.previousHistorySize&&(this.autoScroll=!0,this.userScrolling=!1,this.previousStartMessageId=null,this.historyElement.children[this.historySize-this.previousHistorySize].scrollIntoView(),this.previousHistorySize=null)},onUserInput:function(){this.userScrolling=!0},onScroll:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isScrolledToEnd()){t.next=3;break}return t.next=3,e.$store.dispatch("clearUnreadMessagesCount");case 3:if(e.autoScroll&&(e.autoScroll=!1),!e.userScrolling){t.next=13;break}if(!(e.historyElement.scrollTop<=0)||e.isHistoryFull){t.next=11;break}if(!e.historySize){t.next=11;break}return e.previousStartMessageId=e.chatHistory[0]._id,e.previousHistorySize=e.historySize,t.next=11,e.$store.dispatch("getHistoryChunk");case 11:e.userScrollingTimeout&&clearTimeout(e.userScrollingTimeout),e.userScrollingTimeout=setTimeout((function(){e.userScrolling=!1}),W);case 13:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.scrollHistoryToEnd()},destroyed:function(){this.userScrollingTimeout&&clearTimeout(this.userScrollingTimeout)},updated:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isScrolledToEnd()){t.next=3;break}return t.next=3,e.$store.dispatch("clearUnreadMessagesCount");case 3:n=e.chatHistory.length&&e.previousStartMessageId&&e.previousStartMessageId!==e.chatHistory[0]._id,n?e.scrollToPreviousStart():e.scrollHistoryToEnd();case 5:case"end":return t.stop()}}),t)})))()}},Es=_s,Is=(n("42f9"),Object(w["a"])(Es,ks,ws,!1,null,"09af1ab8",null)),Ts=Is.exports,Us=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("form",{staticClass:"chat-form",on:{submit:e.onSend}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.newMessage,expression:"newMessage"}],staticClass:"chat-input",attrs:{type:"text",placeholder:"Send a message"},domProps:{value:e.newMessage},on:{input:[function(t){t.target.composing||(e.newMessage=t.target.value)},e.onInput],change:e.onBlur}})])},Ms=[],Vs=(n("498a"),{name:"NewMessage",data:function(){return{newMessage:this.draft?this.draft:""}},computed:Object(m["a"])(Object(m["a"])({},Object(A["b"])({chatClient:"chatEngine",chat:"currentChatId",virtualServer:"currentVirtualServerId",userChatStatus:"userChatStatus"})),{},{draft:function(){return this.$store.getters.currentDraft}}),methods:{onBlur:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$store.commit("updateDraft",e.newMessage),t.next=3,e.$store.dispatch("updateUserChatStatus",void 0);case 3:case"end":return t.stop()}}),t)})))()},onInput:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.userChatStatus===e.chat){t.next=3;break}return t.next=3,e.$store.dispatch("updateUserChatStatus",e.chat);case 3:case"end":return t.stop()}}),t)})))()},onSend:function(e){var t=this;return Object(G["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.preventDefault(),t.newMessage){n.next=4;break}return t.$store.commit("postNotification",{message:"Oops... We have nothing to send!"}),n.abrupt("return");case 4:return n.next=6,t.send();case 6:if(!n.sent){n.next=13;break}return t.newMessage="",n.next=10,t.$store.dispatch("afterMessageSending");case 10:t.$store.commit("updateDraft",t.newMessage),n.next=14;break;case 13:t.$store.commit("postNotification",{error:!0,message:"Message was not sent!",title:"Attention. Error!"});case 14:case"end":return n.stop()}}),n)})))()},send:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.chatClient.sendText(e.virtualServer,e.chat,e.newMessage.trim());case 3:n=t.sent,t.next=9;break;case 6:return t.prev=6,t.t0=t["catch"](0),t.abrupt("return",!1);case 9:if(n&&!n.error){t.next=11;break}return t.abrupt("return",!1);case 11:return t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t,null,[[0,6]])})))()}}}),$s=Vs,As=(n("5b0c"),Object(w["a"])($s,Us,Ms,!1,null,"56caa179",null)),Ns=As.exports,Ds=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"status my-2"},[n("p",{staticClass:"text-bright"},[e._v(e._s(e.statusString))])])},Ps=[],Ls={name:"Status",computed:{isActive:function(){return!!this.statusArray.length},statusArray:function(){var e=this;return this.$store.getters.currentChatStatus.filter((function(t){return t!==e.userId}))},statusString:function(){var e=this;if(!this.statusArray.length)return"";var t=this.statusArray.map((function(t){return e.$store.getters.usernameById(t)})).filter((function(e){return e}));if(!t||!t.length)return"";var n=t.length>1;return"".concat(t.join(", ")," ").concat(n?"are writing":"is writing"," now. . .")},userId:function(){return this.$store.getters.user._id}}},Hs=Ls,Bs=(n("fd09"),Object(w["a"])(Hs,Ds,Ps,!1,null,"ee0d9944",null)),Fs=Bs.exports,zs={name:"Chat",components:{appHistory:Ts,appNewMessage:Ns,appStatus:Fs}},qs=zs,Gs=(n("460d"),Object(w["a"])(qs,gs,Cs,!1,null,"b370b6b0",null)),Ys=Gs.exports,Ws=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("app-sub-page-modal",[n("label",[e._v("Do you want to close this room?")]),n("div",{staticClass:"d-flex justify-content-center"},[n("b-button",{directives:[{name:"focus",rawName:"v-focus"}],staticClass:"mr-2",on:{click:e.onCancel}},[e._v("Cancel")]),n("b-button",{attrs:{variant:"danger"},on:{click:e.onDelete}},[e._v("Delete")])],1)])},Js=[],Qs={name:"CreateRoom",components:{appSubPageModal:pa},data:function(){return{voiceChannel:void 0}},computed:Object(m["a"])({},Object(A["b"])(["voiceChannelById","getVoiceChannelContacts"])),methods:{onCancel:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$router.back();case 2:case"end":return t.stop()}}),t)})))()},onDelete:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.getVoiceChannelContacts(e.voiceChannel._id),!n.length){t.next=6;break}return e.$store.commit("postNotification",{error:!0,title:"Error!",message:"Can't close this Room. There are people in this room right now!"}),t.next=5,e.$router.back();case 5:return t.abrupt("return");case 6:return t.next=8,e.$store.dispatch("deleteVoiceChannelOnServer",e.voiceChannel._id);case 8:return t.next=10,e.$router.back();case 10:case"end":return t.stop()}}),t)})))()}},beforeMount:function(){var e=this;return Object(G["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.voiceChannel=e.voiceChannelById(e.$route.params.roomId),e.voiceChannel){t.next=5;break}return e.$store.commit("postNotification",{error:!0,title:"Error!",message:"Room wasn't found"}),t.next=5,e.$router.back();case 5:case"end":return t.stop()}}),t)})))()}},Ks=Qs,Xs=Object(w["a"])(Ks,Ws,Js,!1,null,"54af0a2b",null),Zs=Xs.exports,ei=[{path:"/rooms",component:Yr,name:"rooms",meta:{requiresAuth:!0},children:[{path:"/rooms/create",name:"createRoom",component:ba,meta:{requiresAuth:!0}},{path:"/rooms/:roomId/delete",name:"closeRoom",component:Zs,meta:{requiresAuth:!0}}]},{path:"/rooms/:roomId",component:bs,name:"room",meta:{requiresAuth:!0},children:[{path:"chat",component:Ys,name:"chat"}]}];r["default"].use(H["a"]);var ti=[{path:"/entry",name:"entry",component:Pn},{path:"/sign-in",name:"signIn",component:Ut},{path:"/sign-up",name:"signUp",component:zt},{path:"/free-users",name:"freeUsers",component:Rn,meta:{requiresAuth:!0}},{path:"",name:"home",redirect:{name:"rooms"}},{path:"*",redirect:{name:"home"}}],ni=new H["a"]({mode:"history",base:"/",routes:ti});ni.addRoutes(ei),ni.beforeEach(Hn),ni.afterEach(Ln);var ri=ni;r["default"].use(i["a"]),r["default"].use(o["a"]),r["default"].use(c["a"]),r["default"].use(u["a"]),r["default"].use(l["a"]),r["default"].use(h["a"]),r["default"].use(f["a"]),r["default"].directive("focus",{inserted:function(e){e.focus()}}),r["default"].config.productionTip=!1,r["default"].filter("myDate",(function(e){return e?s()(String(e)).format("DD.MM.YYYY hh:mm:ss"):""})),new r["default"]({router:ri,store:Xe,render:function(e){return e(L)}}).$mount("#app")},"5b0c":function(e,t,n){"use strict";n("e87d")},"5c0b":function(e,t,n){"use strict";n("9c0c")},"5f83":function(e,t,n){},"5f99":function(e,t,n){"use strict";n("7d1c")},"64dd":function(e,t,n){"use strict";n("356d")},"66e8":function(e,t,n){"use strict";n.r(t),n.d(t,"ACTIONS",(function(){return r})),n.d(t,"VOICE_CHANNEL_SERVICE_ACTIONS",(function(){return a})),n.d(t,"CONNECTION_STATUSES",(function(){return s})),n.d(t,"VOICE_CHANNEL_USER_ROLES",(function(){return i})),n.d(t,"ICE_SERVER_URLS",(function(){return o}));var r={text:"text",messageHeader:"message-header",audioInfo:"audio-info",fileInfo:"file-info",binaryOk:"binary-ok",messageFooter:"message-footer",getHistory:"get-history",getChats:"get-chats",getVoiceChannels:"get-voice-channels",createVoiceChannel:"create-voice-channel",deleteVoiceChannel:"delete-voice-channel",getContacts:"get-contacts",getContactsOnline:"get-contacts-online",status:"status",userInfo:"user-info",voiceChannelIce:"voice-channel-ice",voiceChannelOffer:"voice-channel-offer",voiceChannelAnswer:"voice-channel-answer",callRequest:"call-request",callResponse:"call-response"},a=[r.voiceChannelIce,r.voiceChannelOffer,r.voiceChannelAnswer],s={CLOSED:"closed",OPENING:"opening",OPENED:"opened",CLOSING:"CLOSING"},i={listener:"listener",speaker:"speaker",candidate:"candidate"},o=["stun:stun.l.google.com:19302"]},"69d4":function(e,t,n){"use strict";n("d559")},"6aa3":function(e,t,n){"use strict";n("1662")},"6d6c":function(e,t,n){},"6f47":function(e,t,n){"use strict";n("b131")},7318:function(e,t,n){"use strict";n("1404")},7445:function(e,t,n){"use strict";n("7fb0")},"7b82":function(e,t,n){},"7d1c":function(e,t,n){},"7e57":function(e,t,n){"use strict";n("ccaa")},"7fb0":function(e,t,n){},"92ff":function(e,t,n){"use strict";n("9986")},9972:function(e,t,n){"use strict";n("3220")},9986:function(e,t,n){},"9b33":function(e,t,n){"use strict";n("f1cd")},"9c0c":function(e,t,n){},"9ecb":function(e,t,n){"use strict";n("6d6c")},a31e:function(e,t,n){},a5f4:function(e,t,n){},b131:function(e,t,n){},bdd0:function(e,t,n){},c282:function(e,t,n){"use strict";n("a31e")},ccaa:function(e,t,n){},d559:function(e,t,n){},e415:function(e,t,n){"use strict";n("f919")},e6e4:function(e,t,n){},e87d:function(e,t,n){},f1cd:function(e,t,n){},f919:function(e,t,n){},fd09:function(e,t,n){"use strict";n("0f88")}});
//# sourceMappingURL=app.e20c54bb.js.map